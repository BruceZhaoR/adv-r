<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Advanced R</title>
  <meta name="description" content="The book is designed primarily for R users who want to improve their programming skills and understanding of the language. It should also be useful for programmers coming to R from other languages, as it explains some of R’s quirks and shows how some parts that seem horrible do have a positive side.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Advanced R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://adv-r.hadley.nz/" />
  <meta property="og:image" content="https://adv-r.hadley.nz/cover.png" />
  <meta property="og:description" content="The book is designed primarily for R users who want to improve their programming skills and understanding of the language. It should also be useful for programmers coming to R from other languages, as it explains some of R’s quirks and shows how some parts that seem horrible do have a positive side." />
  <meta name="github-repo" content="hadley/adv-r" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Advanced R" />
  <meta name="twitter:site" content="@hadley" />
  <meta name="twitter:description" content="The book is designed primarily for R users who want to improve their programming skills and understanding of the language. It should also be useful for programmers coming to R from other languages, as it explains some of R’s quirks and shows how some parts that seem horrible do have a positive side." />
  <meta name="twitter:image" content="https://adv-r.hadley.nz/cover.png" />

<meta name="author" content="Hadley Wickham">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="meta.html">
<link rel="next" href="quasiquotation.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="adv-r.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Advanced R</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#other-books"><i class="fa fa-check"></i>Other books</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#why-r"><i class="fa fa-check"></i><b>1.1</b> Why R?</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#who-should-read"><i class="fa fa-check"></i><b>1.2</b> Who should read this book</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#what-you-will-get"><i class="fa fa-check"></i><b>1.3</b> What you will get out of this book</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#what-you-will-not-learn"><i class="fa fa-check"></i><b>1.4</b> What you will not learn</a></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#meta-techniques"><i class="fa fa-check"></i><b>1.5</b> Meta-techniques</a></li>
<li class="chapter" data-level="1.6" data-path="introduction.html"><a href="introduction.html#recommended-reading"><i class="fa fa-check"></i><b>1.6</b> Recommended reading</a></li>
<li class="chapter" data-level="1.7" data-path="introduction.html"><a href="introduction.html#getting-help"><i class="fa fa-check"></i><b>1.7</b> Getting help</a></li>
<li class="chapter" data-level="1.8" data-path="introduction.html"><a href="introduction.html#intro-ack"><i class="fa fa-check"></i><b>1.8</b> Acknowledgments</a></li>
<li class="chapter" data-level="1.9" data-path="introduction.html"><a href="introduction.html#conventions"><i class="fa fa-check"></i><b>1.9</b> Conventions</a></li>
<li class="chapter" data-level="1.10" data-path="introduction.html"><a href="introduction.html#colophon"><i class="fa fa-check"></i><b>1.10</b> Colophon</a></li>
</ul></li>
<li class="part"><span><b>I Foundations</b></span></li>
<li class="chapter" data-level="" data-path="foundations-intro.html"><a href="foundations-intro.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="2" data-path="names-values.html"><a href="names-values.html"><i class="fa fa-check"></i><b>2</b> Names and values</a><ul>
<li class="chapter" data-level="2.1" data-path="names-values.html"><a href="names-values.html#introduction-1"><i class="fa fa-check"></i><b>2.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#quiz"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#outline"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="" data-path="names-values.html"><a href="names-values.html#sources"><i class="fa fa-check"></i>Sources</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="names-values.html"><a href="names-values.html#binding-basics"><i class="fa fa-check"></i><b>2.2</b> Binding basics</a><ul>
<li class="chapter" data-level="2.2.1" data-path="names-values.html"><a href="names-values.html#non-syntactic"><i class="fa fa-check"></i><b>2.2.1</b> Non-syntactic names</a></li>
<li class="chapter" data-level="2.2.2" data-path="names-values.html"><a href="names-values.html#exercises"><i class="fa fa-check"></i><b>2.2.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="names-values.html"><a href="names-values.html#copy-on-modify"><i class="fa fa-check"></i><b>2.3</b> Copy-on-modify</a><ul>
<li class="chapter" data-level="2.3.1" data-path="names-values.html"><a href="names-values.html#tracemem"><i class="fa fa-check"></i><b>2.3.1</b> <code>tracemem()</code></a></li>
<li class="chapter" data-level="2.3.2" data-path="names-values.html"><a href="names-values.html#function-calls"><i class="fa fa-check"></i><b>2.3.2</b> Function calls</a></li>
<li class="chapter" data-level="2.3.3" data-path="names-values.html"><a href="names-values.html#list-references"><i class="fa fa-check"></i><b>2.3.3</b> Lists</a></li>
<li class="chapter" data-level="2.3.4" data-path="names-values.html"><a href="names-values.html#df-modify"><i class="fa fa-check"></i><b>2.3.4</b> Data frames</a></li>
<li class="chapter" data-level="2.3.5" data-path="names-values.html"><a href="names-values.html#character-vectors"><i class="fa fa-check"></i><b>2.3.5</b> Character vectors</a></li>
<li class="chapter" data-level="2.3.6" data-path="names-values.html"><a href="names-values.html#exercises-1"><i class="fa fa-check"></i><b>2.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="names-values.html"><a href="names-values.html#object-size"><i class="fa fa-check"></i><b>2.4</b> Object size</a><ul>
<li class="chapter" data-level="2.4.1" data-path="names-values.html"><a href="names-values.html#exercises-2"><i class="fa fa-check"></i><b>2.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="names-values.html"><a href="names-values.html#modify-in-place"><i class="fa fa-check"></i><b>2.5</b> Modify-in-place</a><ul>
<li class="chapter" data-level="2.5.1" data-path="names-values.html"><a href="names-values.html#single-binding"><i class="fa fa-check"></i><b>2.5.1</b> Objects with a single binding</a></li>
<li class="chapter" data-level="2.5.2" data-path="names-values.html"><a href="names-values.html#env-modify"><i class="fa fa-check"></i><b>2.5.2</b> Environments</a></li>
<li class="chapter" data-level="2.5.3" data-path="names-values.html"><a href="names-values.html#exercises-3"><i class="fa fa-check"></i><b>2.5.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="names-values.html"><a href="names-values.html#gc"><i class="fa fa-check"></i><b>2.6</b> Unbinding and the garbage collector</a></li>
<li class="chapter" data-level="2.7" data-path="names-values.html"><a href="names-values.html#names-values-answers"><i class="fa fa-check"></i><b>2.7</b> Answers</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="vectors-chap.html"><a href="vectors-chap.html"><i class="fa fa-check"></i><b>3</b> Vectors</a><ul>
<li class="chapter" data-level="3.1" data-path="vectors-chap.html"><a href="vectors-chap.html#introduction-2"><i class="fa fa-check"></i><b>3.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="vectors-chap.html"><a href="vectors-chap.html#quiz-1"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="vectors-chap.html"><a href="vectors-chap.html#outline-1"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="vectors-chap.html"><a href="vectors-chap.html#atomic-vectors"><i class="fa fa-check"></i><b>3.2</b> Atomic vectors</a><ul>
<li class="chapter" data-level="3.2.1" data-path="vectors-chap.html"><a href="vectors-chap.html#scalars"><i class="fa fa-check"></i><b>3.2.1</b> Scalars</a></li>
<li class="chapter" data-level="3.2.2" data-path="vectors-chap.html"><a href="vectors-chap.html#atomic-constructing"><i class="fa fa-check"></i><b>3.2.2</b> Making longer vectors with <code>c()</code></a></li>
<li class="chapter" data-level="3.2.3" data-path="vectors-chap.html"><a href="vectors-chap.html#testing-and-coercing"><i class="fa fa-check"></i><b>3.2.3</b> Testing and coercing</a></li>
<li class="chapter" data-level="3.2.4" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-4"><i class="fa fa-check"></i><b>3.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="vectors-chap.html"><a href="vectors-chap.html#attributes"><i class="fa fa-check"></i><b>3.3</b> Attributes</a><ul>
<li class="chapter" data-level="3.3.1" data-path="vectors-chap.html"><a href="vectors-chap.html#getting-and-setting"><i class="fa fa-check"></i><b>3.3.1</b> Getting and setting</a></li>
<li class="chapter" data-level="3.3.2" data-path="vectors-chap.html"><a href="vectors-chap.html#attr-names"><i class="fa fa-check"></i><b>3.3.2</b> Names</a></li>
<li class="chapter" data-level="3.3.3" data-path="vectors-chap.html"><a href="vectors-chap.html#attr-dims"><i class="fa fa-check"></i><b>3.3.3</b> Dimensions</a></li>
<li class="chapter" data-level="3.3.4" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-5"><i class="fa fa-check"></i><b>3.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="vectors-chap.html"><a href="vectors-chap.html#s3-atomic-vectors"><i class="fa fa-check"></i><b>3.4</b> S3 atomic vectors</a><ul>
<li class="chapter" data-level="3.4.1" data-path="vectors-chap.html"><a href="vectors-chap.html#factors"><i class="fa fa-check"></i><b>3.4.1</b> Factors</a></li>
<li class="chapter" data-level="3.4.2" data-path="vectors-chap.html"><a href="vectors-chap.html#dates"><i class="fa fa-check"></i><b>3.4.2</b> Dates</a></li>
<li class="chapter" data-level="3.4.3" data-path="vectors-chap.html"><a href="vectors-chap.html#date-times"><i class="fa fa-check"></i><b>3.4.3</b> Date-times</a></li>
<li class="chapter" data-level="3.4.4" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-6"><i class="fa fa-check"></i><b>3.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="vectors-chap.html"><a href="vectors-chap.html#lists"><i class="fa fa-check"></i><b>3.5</b> Lists</a><ul>
<li class="chapter" data-level="3.5.1" data-path="vectors-chap.html"><a href="vectors-chap.html#list-creating"><i class="fa fa-check"></i><b>3.5.1</b> Creating</a></li>
<li class="chapter" data-level="3.5.2" data-path="vectors-chap.html"><a href="vectors-chap.html#list-types"><i class="fa fa-check"></i><b>3.5.2</b> Testing and coercing</a></li>
<li class="chapter" data-level="3.5.3" data-path="vectors-chap.html"><a href="vectors-chap.html#list-array"><i class="fa fa-check"></i><b>3.5.3</b> Matrices and arrays</a></li>
<li class="chapter" data-level="3.5.4" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-7"><i class="fa fa-check"></i><b>3.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="vectors-chap.html"><a href="vectors-chap.html#tibble"><i class="fa fa-check"></i><b>3.6</b> Data frames and tibbles</a><ul>
<li class="chapter" data-level="3.6.1" data-path="vectors-chap.html"><a href="vectors-chap.html#df-create"><i class="fa fa-check"></i><b>3.6.1</b> Creating</a></li>
<li class="chapter" data-level="3.6.2" data-path="vectors-chap.html"><a href="vectors-chap.html#rownames"><i class="fa fa-check"></i><b>3.6.2</b> Row names</a></li>
<li class="chapter" data-level="3.6.3" data-path="vectors-chap.html"><a href="vectors-chap.html#printing"><i class="fa fa-check"></i><b>3.6.3</b> Printing</a></li>
<li class="chapter" data-level="3.6.4" data-path="vectors-chap.html"><a href="vectors-chap.html#safe-subsetting"><i class="fa fa-check"></i><b>3.6.4</b> Subsetting</a></li>
<li class="chapter" data-level="3.6.5" data-path="vectors-chap.html"><a href="vectors-chap.html#df-test-coerce"><i class="fa fa-check"></i><b>3.6.5</b> Testing and coercing</a></li>
<li class="chapter" data-level="3.6.6" data-path="vectors-chap.html"><a href="vectors-chap.html#list-columns"><i class="fa fa-check"></i><b>3.6.6</b> List columns</a></li>
<li class="chapter" data-level="3.6.7" data-path="vectors-chap.html"><a href="vectors-chap.html#matrix-and-data-frame-columns"><i class="fa fa-check"></i><b>3.6.7</b> Matrix and data frame columns</a></li>
<li class="chapter" data-level="3.6.8" data-path="vectors-chap.html"><a href="vectors-chap.html#exercises-8"><i class="fa fa-check"></i><b>3.6.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="vectors-chap.html"><a href="vectors-chap.html#null"><i class="fa fa-check"></i><b>3.7</b> <code>NULL</code></a></li>
<li class="chapter" data-level="3.8" data-path="vectors-chap.html"><a href="vectors-chap.html#data-structure-answers"><i class="fa fa-check"></i><b>3.8</b> Answers</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="subsetting.html"><a href="subsetting.html"><i class="fa fa-check"></i><b>4</b> Subsetting</a><ul>
<li class="chapter" data-level="4.1" data-path="subsetting.html"><a href="subsetting.html#introduction-3"><i class="fa fa-check"></i><b>4.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#quiz-2"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#outline-2"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="subsetting.html"><a href="subsetting.html#subset-multiple"><i class="fa fa-check"></i><b>4.2</b> Selecting multiple elements</a><ul>
<li class="chapter" data-level="4.2.1" data-path="subsetting.html"><a href="subsetting.html#atomic-vectors-1"><i class="fa fa-check"></i><b>4.2.1</b> Atomic vectors</a></li>
<li class="chapter" data-level="4.2.2" data-path="subsetting.html"><a href="subsetting.html#lists-1"><i class="fa fa-check"></i><b>4.2.2</b> Lists</a></li>
<li class="chapter" data-level="4.2.3" data-path="subsetting.html"><a href="subsetting.html#matrix-subsetting"><i class="fa fa-check"></i><b>4.2.3</b> Matrices and arrays</a></li>
<li class="chapter" data-level="4.2.4" data-path="subsetting.html"><a href="subsetting.html#df-subsetting"><i class="fa fa-check"></i><b>4.2.4</b> Data frames and tibbles</a></li>
<li class="chapter" data-level="4.2.5" data-path="subsetting.html"><a href="subsetting.html#simplify-preserve"><i class="fa fa-check"></i><b>4.2.5</b> Preserving dimensionality</a></li>
<li class="chapter" data-level="4.2.6" data-path="subsetting.html"><a href="subsetting.html#exercises-9"><i class="fa fa-check"></i><b>4.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="subsetting.html"><a href="subsetting.html#subset-single"><i class="fa fa-check"></i><b>4.3</b> Selecting a single element</a><ul>
<li class="chapter" data-level="4.3.1" data-path="subsetting.html"><a href="subsetting.html#section"><i class="fa fa-check"></i><b>4.3.1</b> <code>[[</code></a></li>
<li class="chapter" data-level="4.3.2" data-path="subsetting.html"><a href="subsetting.html#section-1"><i class="fa fa-check"></i><b>4.3.2</b> <code>$</code></a></li>
<li class="chapter" data-level="4.3.3" data-path="subsetting.html"><a href="subsetting.html#missingout-of-bounds-indices"><i class="fa fa-check"></i><b>4.3.3</b> Missing/out of bounds indices</a></li>
<li class="chapter" data-level="4.3.4" data-path="subsetting.html"><a href="subsetting.html#and-slot"><i class="fa fa-check"></i><b>4.3.4</b> <code>@</code> and <code>slot()</code></a></li>
<li class="chapter" data-level="4.3.5" data-path="subsetting.html"><a href="subsetting.html#exercises-10"><i class="fa fa-check"></i><b>4.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="subsetting.html"><a href="subsetting.html#subassignment"><i class="fa fa-check"></i><b>4.4</b> Subsetting and assignment</a></li>
<li class="chapter" data-level="4.5" data-path="subsetting.html"><a href="subsetting.html#applications"><i class="fa fa-check"></i><b>4.5</b> Applications</a><ul>
<li class="chapter" data-level="4.5.1" data-path="subsetting.html"><a href="subsetting.html#lookup-tables"><i class="fa fa-check"></i><b>4.5.1</b> Lookup tables (character subsetting)</a></li>
<li class="chapter" data-level="4.5.2" data-path="subsetting.html"><a href="subsetting.html#matching-merging"><i class="fa fa-check"></i><b>4.5.2</b> Matching and merging by hand (integer subsetting)</a></li>
<li class="chapter" data-level="4.5.3" data-path="subsetting.html"><a href="subsetting.html#random-samplesbootstraps-integer-subsetting"><i class="fa fa-check"></i><b>4.5.3</b> Random samples/bootstraps (integer subsetting)</a></li>
<li class="chapter" data-level="4.5.4" data-path="subsetting.html"><a href="subsetting.html#ordering-integer-subsetting"><i class="fa fa-check"></i><b>4.5.4</b> Ordering (integer subsetting)</a></li>
<li class="chapter" data-level="4.5.5" data-path="subsetting.html"><a href="subsetting.html#expanding-aggregated-counts-integer-subsetting"><i class="fa fa-check"></i><b>4.5.5</b> Expanding aggregated counts (integer subsetting)</a></li>
<li class="chapter" data-level="4.5.6" data-path="subsetting.html"><a href="subsetting.html#removing-columns-from-data-frames-character-subsetting"><i class="fa fa-check"></i><b>4.5.6</b> Removing columns from data frames (character subsetting)</a></li>
<li class="chapter" data-level="4.5.7" data-path="subsetting.html"><a href="subsetting.html#selecting-rows-based-on-a-condition-logical-subsetting"><i class="fa fa-check"></i><b>4.5.7</b> Selecting rows based on a condition (logical subsetting)</a></li>
<li class="chapter" data-level="4.5.8" data-path="subsetting.html"><a href="subsetting.html#boolean-algebra-vs.sets-logical-integer-subsetting"><i class="fa fa-check"></i><b>4.5.8</b> Boolean algebra vs. sets (logical &amp; integer subsetting)</a></li>
<li class="chapter" data-level="4.5.9" data-path="subsetting.html"><a href="subsetting.html#exercises-11"><i class="fa fa-check"></i><b>4.5.9</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="subsetting.html"><a href="subsetting.html#subsetting-answers"><i class="fa fa-check"></i><b>4.6</b> Answers</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>5</b> Functions</a><ul>
<li class="chapter" data-level="5.1" data-path="functions.html"><a href="functions.html#introduction-4"><i class="fa fa-check"></i><b>5.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#quiz-3"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#outline-3"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="functions.html"><a href="functions.html#function-fundamentals"><i class="fa fa-check"></i><b>5.2</b> Function fundamentals</a><ul>
<li class="chapter" data-level="5.2.1" data-path="functions.html"><a href="functions.html#first-class-functions"><i class="fa fa-check"></i><b>5.2.1</b> First-class functions</a></li>
<li class="chapter" data-level="5.2.2" data-path="functions.html"><a href="functions.html#function-components"><i class="fa fa-check"></i><b>5.2.2</b> Function components</a></li>
<li class="chapter" data-level="5.2.3" data-path="functions.html"><a href="functions.html#primitive-functions"><i class="fa fa-check"></i><b>5.2.3</b> Primitive functions</a></li>
<li class="chapter" data-level="5.2.4" data-path="functions.html"><a href="functions.html#exercises-12"><i class="fa fa-check"></i><b>5.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="functions.html"><a href="functions.html#function-composition"><i class="fa fa-check"></i><b>5.3</b> Function composition</a></li>
<li class="chapter" data-level="5.4" data-path="functions.html"><a href="functions.html#lexical-scoping"><i class="fa fa-check"></i><b>5.4</b> Lexical scoping</a><ul>
<li class="chapter" data-level="5.4.1" data-path="functions.html"><a href="functions.html#name-masking"><i class="fa fa-check"></i><b>5.4.1</b> Name masking</a></li>
<li class="chapter" data-level="5.4.2" data-path="functions.html"><a href="functions.html#functions-vs.variables"><i class="fa fa-check"></i><b>5.4.2</b> Functions vs. variables</a></li>
<li class="chapter" data-level="5.4.3" data-path="functions.html"><a href="functions.html#fresh-start"><i class="fa fa-check"></i><b>5.4.3</b> A fresh start</a></li>
<li class="chapter" data-level="5.4.4" data-path="functions.html"><a href="functions.html#dynamic-lookup"><i class="fa fa-check"></i><b>5.4.4</b> Dynamic lookup</a></li>
<li class="chapter" data-level="5.4.5" data-path="functions.html"><a href="functions.html#exercises-13"><i class="fa fa-check"></i><b>5.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="functions.html"><a href="functions.html#lazy-evaluation"><i class="fa fa-check"></i><b>5.5</b> Lazy evaluation</a><ul>
<li class="chapter" data-level="5.5.1" data-path="functions.html"><a href="functions.html#forcing-evaluation"><i class="fa fa-check"></i><b>5.5.1</b> Forcing evaluation</a></li>
<li class="chapter" data-level="5.5.2" data-path="functions.html"><a href="functions.html#promises"><i class="fa fa-check"></i><b>5.5.2</b> Promises</a></li>
<li class="chapter" data-level="5.5.3" data-path="functions.html"><a href="functions.html#default-arguments"><i class="fa fa-check"></i><b>5.5.3</b> Default arguments</a></li>
<li class="chapter" data-level="5.5.4" data-path="functions.html"><a href="functions.html#missing-arguments"><i class="fa fa-check"></i><b>5.5.4</b> Missing arguments</a></li>
<li class="chapter" data-level="5.5.5" data-path="functions.html"><a href="functions.html#exercises-14"><i class="fa fa-check"></i><b>5.5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="functions.html"><a href="functions.html#fun-dot-dot-dot"><i class="fa fa-check"></i><b>5.6</b> <code>...</code> (dot-dot-dot)</a><ul>
<li class="chapter" data-level="5.6.1" data-path="functions.html"><a href="functions.html#exercises-15"><i class="fa fa-check"></i><b>5.6.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="functions.html"><a href="functions.html#exiting-a-function"><i class="fa fa-check"></i><b>5.7</b> Exiting a function</a><ul>
<li class="chapter" data-level="5.7.1" data-path="functions.html"><a href="functions.html#implicit-vs.explicit-returns"><i class="fa fa-check"></i><b>5.7.1</b> Implicit vs. explicit returns</a></li>
<li class="chapter" data-level="5.7.2" data-path="functions.html"><a href="functions.html#invisible-values"><i class="fa fa-check"></i><b>5.7.2</b> Invisible values</a></li>
<li class="chapter" data-level="5.7.3" data-path="functions.html"><a href="functions.html#errors"><i class="fa fa-check"></i><b>5.7.3</b> Errors</a></li>
<li class="chapter" data-level="5.7.4" data-path="functions.html"><a href="functions.html#on-exit"><i class="fa fa-check"></i><b>5.7.4</b> Exit handlers</a></li>
<li class="chapter" data-level="5.7.5" data-path="functions.html"><a href="functions.html#exercises-16"><i class="fa fa-check"></i><b>5.7.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="functions.html"><a href="functions.html#function-forms"><i class="fa fa-check"></i><b>5.8</b> Function forms</a><ul>
<li class="chapter" data-level="5.8.1" data-path="functions.html"><a href="functions.html#prefix-form"><i class="fa fa-check"></i><b>5.8.1</b> Rewriting to prefix form</a></li>
<li class="chapter" data-level="5.8.2" data-path="functions.html"><a href="functions.html#prefix-form"><i class="fa fa-check"></i><b>5.8.2</b> Prefix form</a></li>
<li class="chapter" data-level="5.8.3" data-path="functions.html"><a href="functions.html#infix-functions"><i class="fa fa-check"></i><b>5.8.3</b> Infix functions</a></li>
<li class="chapter" data-level="5.8.4" data-path="functions.html"><a href="functions.html#replacement-functions"><i class="fa fa-check"></i><b>5.8.4</b> Replacement functions</a></li>
<li class="chapter" data-level="5.8.5" data-path="functions.html"><a href="functions.html#special-forms"><i class="fa fa-check"></i><b>5.8.5</b> Special forms</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="functions.html"><a href="functions.html#invoking-a-function"><i class="fa fa-check"></i><b>5.9</b> Invoking a function</a><ul>
<li class="chapter" data-level="5.9.1" data-path="functions.html"><a href="functions.html#exercises-17"><i class="fa fa-check"></i><b>5.9.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.10" data-path="functions.html"><a href="functions.html#function-answers"><i class="fa fa-check"></i><b>5.10</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="environments.html"><a href="environments.html"><i class="fa fa-check"></i><b>6</b> Environments</a><ul>
<li class="chapter" data-level="6.1" data-path="environments.html"><a href="environments.html#introduction-5"><i class="fa fa-check"></i><b>6.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#quiz-4"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#outline-4"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#prerequisites-1"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="environments.html"><a href="environments.html#env-basics"><i class="fa fa-check"></i><b>6.2</b> Environment basics</a><ul>
<li class="chapter" data-level="6.2.1" data-path="environments.html"><a href="environments.html#basics"><i class="fa fa-check"></i><b>6.2.1</b> Basics</a></li>
<li class="chapter" data-level="6.2.2" data-path="environments.html"><a href="environments.html#important-environments"><i class="fa fa-check"></i><b>6.2.2</b> Important environments</a></li>
<li class="chapter" data-level="6.2.3" data-path="environments.html"><a href="environments.html#parents"><i class="fa fa-check"></i><b>6.2.3</b> Parents</a></li>
<li class="chapter" data-level="6.2.4" data-path="environments.html"><a href="environments.html#super-assigment--"><i class="fa fa-check"></i><b>6.2.4</b> Super assigment, <code>&lt;&lt;-</code></a></li>
<li class="chapter" data-level="6.2.5" data-path="environments.html"><a href="environments.html#getting-and-setting-1"><i class="fa fa-check"></i><b>6.2.5</b> Getting and setting</a></li>
<li class="chapter" data-level="6.2.6" data-path="environments.html"><a href="environments.html#finalisers"><i class="fa fa-check"></i><b>6.2.6</b> Finalisers</a></li>
<li class="chapter" data-level="6.2.7" data-path="environments.html"><a href="environments.html#advanced-bindings"><i class="fa fa-check"></i><b>6.2.7</b> Advanced bindings</a></li>
<li class="chapter" data-level="6.2.8" data-path="environments.html"><a href="environments.html#exercises-18"><i class="fa fa-check"></i><b>6.2.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="environments.html"><a href="environments.html#env-recursion"><i class="fa fa-check"></i><b>6.3</b> Recursing over environments</a><ul>
<li class="chapter" data-level="6.3.1" data-path="environments.html"><a href="environments.html#exercises-19"><i class="fa fa-check"></i><b>6.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="environments.html"><a href="environments.html#function-envs"><i class="fa fa-check"></i><b>6.4</b> Special environments</a><ul>
<li class="chapter" data-level="6.4.1" data-path="environments.html"><a href="environments.html#package-environments-and-the-search-path"><i class="fa fa-check"></i><b>6.4.1</b> Package environments and the search path</a></li>
<li class="chapter" data-level="6.4.2" data-path="environments.html"><a href="environments.html#the-function-environment"><i class="fa fa-check"></i><b>6.4.2</b> The function environment</a></li>
<li class="chapter" data-level="6.4.3" data-path="environments.html"><a href="environments.html#namespaces"><i class="fa fa-check"></i><b>6.4.3</b> Namespaces</a></li>
<li class="chapter" data-level="6.4.4" data-path="environments.html"><a href="environments.html#execution-environments"><i class="fa fa-check"></i><b>6.4.4</b> Execution environments</a></li>
<li class="chapter" data-level="6.4.5" data-path="environments.html"><a href="environments.html#exercises-20"><i class="fa fa-check"></i><b>6.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="environments.html"><a href="environments.html#call-stack"><i class="fa fa-check"></i><b>6.5</b> The call stack</a><ul>
<li class="chapter" data-level="6.5.1" data-path="environments.html"><a href="environments.html#simple-call-stacks"><i class="fa fa-check"></i><b>6.5.1</b> Simple call stacks</a></li>
<li class="chapter" data-level="6.5.2" data-path="environments.html"><a href="environments.html#lazy-evaluation-1"><i class="fa fa-check"></i><b>6.5.2</b> Lazy evaluation</a></li>
<li class="chapter" data-level="6.5.3" data-path="environments.html"><a href="environments.html#frames"><i class="fa fa-check"></i><b>6.5.3</b> Frames</a></li>
<li class="chapter" data-level="6.5.4" data-path="environments.html"><a href="environments.html#dynamic-scope"><i class="fa fa-check"></i><b>6.5.4</b> Dynamic scope</a></li>
<li class="chapter" data-level="6.5.5" data-path="environments.html"><a href="environments.html#exercises-21"><i class="fa fa-check"></i><b>6.5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="environments.html"><a href="environments.html#explicit-envs"><i class="fa fa-check"></i><b>6.6</b> As data structures</a></li>
<li class="chapter" data-level="6.7" data-path="environments.html"><a href="environments.html#env-answers"><i class="fa fa-check"></i><b>6.7</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="conditions.html"><a href="conditions.html"><i class="fa fa-check"></i><b>7</b> Conditions</a><ul>
<li class="chapter" data-level="7.1" data-path="conditions.html"><a href="conditions.html#introduction-6"><i class="fa fa-check"></i><b>7.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#quiz-5"><i class="fa fa-check"></i>Quiz</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#overview"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="7.1.1" data-path="conditions.html"><a href="conditions.html#prerequisites-2"><i class="fa fa-check"></i><b>7.1.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="conditions.html"><a href="conditions.html#signalling-conditions"><i class="fa fa-check"></i><b>7.2</b> Signalling conditions</a><ul>
<li class="chapter" data-level="7.2.1" data-path="conditions.html"><a href="conditions.html#errors-1"><i class="fa fa-check"></i><b>7.2.1</b> Errors</a></li>
<li class="chapter" data-level="7.2.2" data-path="conditions.html"><a href="conditions.html#warnings"><i class="fa fa-check"></i><b>7.2.2</b> Warnings</a></li>
<li class="chapter" data-level="7.2.3" data-path="conditions.html"><a href="conditions.html#messages"><i class="fa fa-check"></i><b>7.2.3</b> Messages</a></li>
<li class="chapter" data-level="7.2.4" data-path="conditions.html"><a href="conditions.html#exercises-22"><i class="fa fa-check"></i><b>7.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="conditions.html"><a href="conditions.html#ignoring-conditions"><i class="fa fa-check"></i><b>7.3</b> Ignoring conditions</a></li>
<li class="chapter" data-level="7.4" data-path="conditions.html"><a href="conditions.html#handling-conditions"><i class="fa fa-check"></i><b>7.4</b> Handling conditions</a><ul>
<li class="chapter" data-level="7.4.1" data-path="conditions.html"><a href="conditions.html#condition-objects"><i class="fa fa-check"></i><b>7.4.1</b> Condition objects</a></li>
<li class="chapter" data-level="7.4.2" data-path="conditions.html"><a href="conditions.html#exiting-handlers"><i class="fa fa-check"></i><b>7.4.2</b> Exiting handlers</a></li>
<li class="chapter" data-level="7.4.3" data-path="conditions.html"><a href="conditions.html#calling-handlers"><i class="fa fa-check"></i><b>7.4.3</b> Calling handlers</a></li>
<li class="chapter" data-level="7.4.4" data-path="conditions.html"><a href="conditions.html#call-stacks"><i class="fa fa-check"></i><b>7.4.4</b> Call stacks</a></li>
<li class="chapter" data-level="7.4.5" data-path="conditions.html"><a href="conditions.html#exercises-23"><i class="fa fa-check"></i><b>7.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="conditions.html"><a href="conditions.html#custom-conditions"><i class="fa fa-check"></i><b>7.5</b> Custom conditions</a><ul>
<li class="chapter" data-level="7.5.1" data-path="conditions.html"><a href="conditions.html#motivation"><i class="fa fa-check"></i><b>7.5.1</b> Motivation</a></li>
<li class="chapter" data-level="7.5.2" data-path="conditions.html"><a href="conditions.html#signalling"><i class="fa fa-check"></i><b>7.5.2</b> Signalling</a></li>
<li class="chapter" data-level="7.5.3" data-path="conditions.html"><a href="conditions.html#handling"><i class="fa fa-check"></i><b>7.5.3</b> Handling</a></li>
<li class="chapter" data-level="7.5.4" data-path="conditions.html"><a href="conditions.html#exercises-24"><i class="fa fa-check"></i><b>7.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="conditions.html"><a href="conditions.html#condition-applications"><i class="fa fa-check"></i><b>7.6</b> Applications</a><ul>
<li class="chapter" data-level="7.6.1" data-path="conditions.html"><a href="conditions.html#failure-value"><i class="fa fa-check"></i><b>7.6.1</b> Failure value</a></li>
<li class="chapter" data-level="7.6.2" data-path="conditions.html"><a href="conditions.html#try-success-failure"><i class="fa fa-check"></i><b>7.6.2</b> Success and failure values</a></li>
<li class="chapter" data-level="7.6.3" data-path="conditions.html"><a href="conditions.html#resignal"><i class="fa fa-check"></i><b>7.6.3</b> Resignal</a></li>
<li class="chapter" data-level="7.6.4" data-path="conditions.html"><a href="conditions.html#record"><i class="fa fa-check"></i><b>7.6.4</b> Record</a></li>
<li class="chapter" data-level="7.6.5" data-path="conditions.html"><a href="conditions.html#no-default-behaviour"><i class="fa fa-check"></i><b>7.6.5</b> No default behaviour</a></li>
<li class="chapter" data-level="7.6.6" data-path="conditions.html"><a href="conditions.html#exercises-25"><i class="fa fa-check"></i><b>7.6.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="conditions.html"><a href="conditions.html#conditions-answers"><i class="fa fa-check"></i><b>7.7</b> Quiz answers</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="connections.html"><a href="connections.html"><i class="fa fa-check"></i><b>8</b> Connections</a><ul>
<li class="chapter" data-level="8.1" data-path="connections.html"><a href="connections.html#basics-1"><i class="fa fa-check"></i><b>8.1</b> Basics</a></li>
<li class="chapter" data-level="8.2" data-path="connections.html"><a href="connections.html#reading-and-writing-binary-data"><i class="fa fa-check"></i><b>8.2</b> Reading and writing binary data</a></li>
<li class="chapter" data-level="8.3" data-path="connections.html"><a href="connections.html#reading-and-writing-text-data"><i class="fa fa-check"></i><b>8.3</b> Reading and writing text data</a></li>
</ul></li>
<li class="part"><span><b>II Functional programming</b></span></li>
<li class="chapter" data-level="" data-path="fp.html"><a href="fp.html"><i class="fa fa-check"></i>Introduction</a><ul>
<li class="chapter" data-level="" data-path="fp.html"><a href="fp.html#functional-programming-languages"><i class="fa fa-check"></i>Functional programming languages</a></li>
<li class="chapter" data-level="" data-path="fp.html"><a href="fp.html#functional-style"><i class="fa fa-check"></i>Functional style</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="functionals.html"><a href="functionals.html"><i class="fa fa-check"></i><b>9</b> Functionals</a><ul>
<li class="chapter" data-level="9.1" data-path="functionals.html"><a href="functionals.html#introduction-7"><i class="fa fa-check"></i><b>9.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#outline-5"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#prerequisites-3"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="functionals.html"><a href="functionals.html#map"><i class="fa fa-check"></i><b>9.2</b> My first functional: <code>map()</code></a><ul>
<li class="chapter" data-level="9.2.1" data-path="functionals.html"><a href="functionals.html#producing-atomic-vectors"><i class="fa fa-check"></i><b>9.2.1</b> Producing atomic vectors</a></li>
<li class="chapter" data-level="9.2.2" data-path="functionals.html"><a href="functionals.html#anonymous-functions-and-helpers"><i class="fa fa-check"></i><b>9.2.2</b> Anonymous functions and helpers</a></li>
<li class="chapter" data-level="9.2.3" data-path="functionals.html"><a href="functionals.html#passing-arguments"><i class="fa fa-check"></i><b>9.2.3</b> Passing arguments with <code>...</code></a></li>
<li class="chapter" data-level="9.2.4" data-path="functionals.html"><a href="functionals.html#argument-names"><i class="fa fa-check"></i><b>9.2.4</b> Argument names</a></li>
<li class="chapter" data-level="9.2.5" data-path="functionals.html"><a href="functionals.html#change-argument"><i class="fa fa-check"></i><b>9.2.5</b> Varying another argument</a></li>
<li class="chapter" data-level="9.2.6" data-path="functionals.html"><a href="functionals.html#exercises-26"><i class="fa fa-check"></i><b>9.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="functionals.html"><a href="functionals.html#purrr-style"><i class="fa fa-check"></i><b>9.3</b> Purrr style</a></li>
<li class="chapter" data-level="9.4" data-path="functionals.html"><a href="functionals.html#functionals-loop"><i class="fa fa-check"></i><b>9.4</b> Map variants</a><ul>
<li class="chapter" data-level="9.4.1" data-path="functionals.html"><a href="functionals.html#modify"><i class="fa fa-check"></i><b>9.4.1</b> Same type of output as input: <code>modify()</code></a></li>
<li class="chapter" data-level="9.4.2" data-path="functionals.html"><a href="functionals.html#map2"><i class="fa fa-check"></i><b>9.4.2</b> Two inputs: <code>map2()</code> and friends</a></li>
<li class="chapter" data-level="9.4.3" data-path="functionals.html"><a href="functionals.html#no-outputs-walk-and-friends"><i class="fa fa-check"></i><b>9.4.3</b> No outputs: <code>walk()</code> and friends</a></li>
<li class="chapter" data-level="9.4.4" data-path="functionals.html"><a href="functionals.html#iterating-over-values-and-indices"><i class="fa fa-check"></i><b>9.4.4</b> Iterating over values and indices</a></li>
<li class="chapter" data-level="9.4.5" data-path="functionals.html"><a href="functionals.html#pmap"><i class="fa fa-check"></i><b>9.4.5</b> Any number of inputs: <code>pmap()</code> and friends</a></li>
<li class="chapter" data-level="9.4.6" data-path="functionals.html"><a href="functionals.html#exercises-27"><i class="fa fa-check"></i><b>9.4.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="functionals.html"><a href="functionals.html#reduce"><i class="fa fa-check"></i><b>9.5</b> Reduce</a><ul>
<li class="chapter" data-level="9.5.1" data-path="functionals.html"><a href="functionals.html#basics-2"><i class="fa fa-check"></i><b>9.5.1</b> Basics</a></li>
<li class="chapter" data-level="9.5.2" data-path="functionals.html"><a href="functionals.html#accumulate"><i class="fa fa-check"></i><b>9.5.2</b> Accumulate</a></li>
<li class="chapter" data-level="9.5.3" data-path="functionals.html"><a href="functionals.html#output-types"><i class="fa fa-check"></i><b>9.5.3</b> Output types</a></li>
<li class="chapter" data-level="9.5.4" data-path="functionals.html"><a href="functionals.html#multiple-inputs"><i class="fa fa-check"></i><b>9.5.4</b> Multiple inputs</a></li>
<li class="chapter" data-level="9.5.5" data-path="functionals.html"><a href="functionals.html#map-reduce"><i class="fa fa-check"></i><b>9.5.5</b> Map-reduce</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="functionals.html"><a href="functionals.html#predicate-functionals"><i class="fa fa-check"></i><b>9.6</b> Predicate functionals</a><ul>
<li class="chapter" data-level="9.6.1" data-path="functionals.html"><a href="functionals.html#basics-3"><i class="fa fa-check"></i><b>9.6.1</b> Basics</a></li>
<li class="chapter" data-level="9.6.2" data-path="functionals.html"><a href="functionals.html#predicate-map"><i class="fa fa-check"></i><b>9.6.2</b> Map variants</a></li>
<li class="chapter" data-level="9.6.3" data-path="functionals.html"><a href="functionals.html#exercises-28"><i class="fa fa-check"></i><b>9.6.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="functionals.html"><a href="functionals.html#functionals-math"><i class="fa fa-check"></i><b>9.7</b> Base functionals</a><ul>
<li class="chapter" data-level="9.7.1" data-path="functionals.html"><a href="functionals.html#matrices-and-arrays"><i class="fa fa-check"></i><b>9.7.1</b> Matrices and arrays</a></li>
<li class="chapter" data-level="9.7.2" data-path="functionals.html"><a href="functionals.html#ragged-arrays"><i class="fa fa-check"></i><b>9.7.2</b> “Ragged” arrays</a></li>
<li class="chapter" data-level="9.7.3" data-path="functionals.html"><a href="functionals.html#mathematical"><i class="fa fa-check"></i><b>9.7.3</b> Mathematical</a></li>
<li class="chapter" data-level="9.7.4" data-path="functionals.html"><a href="functionals.html#exercises-29"><i class="fa fa-check"></i><b>9.7.4</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="function-factories.html"><a href="function-factories.html"><i class="fa fa-check"></i><b>10</b> Function factories</a><ul>
<li class="chapter" data-level="10.1" data-path="function-factories.html"><a href="function-factories.html#introduction-8"><i class="fa fa-check"></i><b>10.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#outline-6"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#prerequisites-4"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="function-factories.html"><a href="function-factories.html#factory-fundamentals"><i class="fa fa-check"></i><b>10.2</b> Factory fundamentals</a><ul>
<li class="chapter" data-level="10.2.1" data-path="function-factories.html"><a href="function-factories.html#environments-1"><i class="fa fa-check"></i><b>10.2.1</b> Environments</a></li>
<li class="chapter" data-level="10.2.2" data-path="function-factories.html"><a href="function-factories.html#diagram-conventions"><i class="fa fa-check"></i><b>10.2.2</b> Diagram conventions</a></li>
<li class="chapter" data-level="10.2.3" data-path="function-factories.html"><a href="function-factories.html#stateful-funs"><i class="fa fa-check"></i><b>10.2.3</b> Stateful functions</a></li>
<li class="chapter" data-level="10.2.4" data-path="function-factories.html"><a href="function-factories.html#factory-pitfalls"><i class="fa fa-check"></i><b>10.2.4</b> Potential pitfalls</a></li>
<li class="chapter" data-level="10.2.5" data-path="function-factories.html"><a href="function-factories.html#exercises-30"><i class="fa fa-check"></i><b>10.2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="function-factories.html"><a href="function-factories.html#graph-fact"><i class="fa fa-check"></i><b>10.3</b> Graphical factories</a><ul>
<li class="chapter" data-level="10.3.1" data-path="function-factories.html"><a href="function-factories.html#labelling"><i class="fa fa-check"></i><b>10.3.1</b> Labelling</a></li>
<li class="chapter" data-level="10.3.2" data-path="function-factories.html"><a href="function-factories.html#histogram-bins"><i class="fa fa-check"></i><b>10.3.2</b> Histogram bins</a></li>
<li class="chapter" data-level="10.3.3" data-path="function-factories.html"><a href="function-factories.html#ggsave"><i class="fa fa-check"></i><b>10.3.3</b> ggsave</a></li>
<li class="chapter" data-level="10.3.4" data-path="function-factories.html"><a href="function-factories.html#exercises-31"><i class="fa fa-check"></i><b>10.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="function-factories.html"><a href="function-factories.html#stat-fact"><i class="fa fa-check"></i><b>10.4</b> Statistical factories</a><ul>
<li class="chapter" data-level="10.4.1" data-path="function-factories.html"><a href="function-factories.html#box-cox-transformation"><i class="fa fa-check"></i><b>10.4.1</b> Box-Cox transformation</a></li>
<li class="chapter" data-level="10.4.2" data-path="function-factories.html"><a href="function-factories.html#bootstrap-generators"><i class="fa fa-check"></i><b>10.4.2</b> Bootstrap generators</a></li>
<li class="chapter" data-level="10.4.3" data-path="function-factories.html"><a href="function-factories.html#MLE"><i class="fa fa-check"></i><b>10.4.3</b> Maximum likelihood estimation</a></li>
<li class="chapter" data-level="10.4.4" data-path="function-factories.html"><a href="function-factories.html#exercises-32"><i class="fa fa-check"></i><b>10.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="function-factories.html"><a href="function-factories.html#functional-factories"><i class="fa fa-check"></i><b>10.5</b> Function factories + functionals</a><ul>
<li class="chapter" data-level="10.5.1" data-path="function-factories.html"><a href="function-factories.html#moving-a-list-to-the-global-environment"><i class="fa fa-check"></i><b>10.5.1</b> Moving a list to the global environment</a></li>
<li class="chapter" data-level="10.5.2" data-path="function-factories.html"><a href="function-factories.html#another-approach"><i class="fa fa-check"></i><b>10.5.2</b> Another approach</a></li>
<li class="chapter" data-level="10.5.3" data-path="function-factories.html"><a href="function-factories.html#exercises-33"><i class="fa fa-check"></i><b>10.5.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="function-operators.html"><a href="function-operators.html"><i class="fa fa-check"></i><b>11</b> Function operators</a><ul>
<li class="chapter" data-level="11.1" data-path="function-operators.html"><a href="function-operators.html#introduction-9"><i class="fa fa-check"></i><b>11.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="function-operators.html"><a href="function-operators.html#outline-7"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="function-operators.html"><a href="function-operators.html#prerequisites-5"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="function-operators.html"><a href="function-operators.html#existing-fos"><i class="fa fa-check"></i><b>11.2</b> Existing FOs</a><ul>
<li class="chapter" data-level="11.2.1" data-path="function-operators.html"><a href="function-operators.html#safely"><i class="fa fa-check"></i><b>11.2.1</b> Capturing errors with <code>purrr::safely()</code></a></li>
<li class="chapter" data-level="11.2.2" data-path="function-operators.html"><a href="function-operators.html#memoise"><i class="fa fa-check"></i><b>11.2.2</b> Caching computations with <code>memoise::memoise()</code></a></li>
<li class="chapter" data-level="11.2.3" data-path="function-operators.html"><a href="function-operators.html#exercises-34"><i class="fa fa-check"></i><b>11.2.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="function-operators.html"><a href="function-operators.html#fo-case-study"><i class="fa fa-check"></i><b>11.3</b> Case study: creating your own FOs</a><ul>
<li class="chapter" data-level="11.3.1" data-path="function-operators.html"><a href="function-operators.html#exercises-35"><i class="fa fa-check"></i><b>11.3.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Object oriented programming</b></span></li>
<li class="chapter" data-level="" data-path="oo.html"><a href="oo.html"><i class="fa fa-check"></i>Introduction</a><ul>
<li class="chapter" data-level="" data-path="oo.html"><a href="oo.html#oop-systems"><i class="fa fa-check"></i>OOP systems</a></li>
<li class="chapter" data-level="" data-path="oo.html"><a href="oo.html#oop-in-r"><i class="fa fa-check"></i>OOP in R</a></li>
<li class="chapter" data-level="" data-path="oo.html"><a href="oo.html#sloop"><i class="fa fa-check"></i>sloop</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="base-types.html"><a href="base-types.html"><i class="fa fa-check"></i><b>12</b> Base types</a><ul>
<li class="chapter" data-level="12.1" data-path="base-types.html"><a href="base-types.html#introduction-10"><i class="fa fa-check"></i><b>12.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="base-types.html"><a href="base-types.html#outline-8"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="base-types.html"><a href="base-types.html#base-vs-oo"><i class="fa fa-check"></i><b>12.2</b> Base vs OO objects</a></li>
<li class="chapter" data-level="12.3" data-path="base-types.html"><a href="base-types.html#base-types-2"><i class="fa fa-check"></i><b>12.3</b> Base types</a><ul>
<li class="chapter" data-level="12.3.1" data-path="base-types.html"><a href="base-types.html#numeric-type"><i class="fa fa-check"></i><b>12.3.1</b> Numeric type</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="s3.html"><a href="s3.html"><i class="fa fa-check"></i><b>13</b> S3</a><ul>
<li class="chapter" data-level="13.1" data-path="s3.html"><a href="s3.html#introduction-11"><i class="fa fa-check"></i><b>13.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#outline-9"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#prerequisites-6"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="s3.html"><a href="s3.html#s3-basics"><i class="fa fa-check"></i><b>13.2</b> Basics</a><ul>
<li class="chapter" data-level="13.2.1" data-path="s3.html"><a href="s3.html#exercises-36"><i class="fa fa-check"></i><b>13.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="s3.html"><a href="s3.html#s3-classes"><i class="fa fa-check"></i><b>13.3</b> Classes</a><ul>
<li class="chapter" data-level="13.3.1" data-path="s3.html"><a href="s3.html#s3-constrcutor"><i class="fa fa-check"></i><b>13.3.1</b> Constructors</a></li>
<li class="chapter" data-level="13.3.2" data-path="s3.html"><a href="s3.html#validators"><i class="fa fa-check"></i><b>13.3.2</b> Validators</a></li>
<li class="chapter" data-level="13.3.3" data-path="s3.html"><a href="s3.html#helpers"><i class="fa fa-check"></i><b>13.3.3</b> Helpers</a></li>
<li class="chapter" data-level="13.3.4" data-path="s3.html"><a href="s3.html#exercises-37"><i class="fa fa-check"></i><b>13.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="s3.html"><a href="s3.html#s3-methods"><i class="fa fa-check"></i><b>13.4</b> Generics and methods</a><ul>
<li class="chapter" data-level="13.4.1" data-path="s3.html"><a href="s3.html#method-dispatch"><i class="fa fa-check"></i><b>13.4.1</b> Method dispatch</a></li>
<li class="chapter" data-level="13.4.2" data-path="s3.html"><a href="s3.html#finding-methods"><i class="fa fa-check"></i><b>13.4.2</b> Finding methods</a></li>
<li class="chapter" data-level="13.4.3" data-path="s3.html"><a href="s3.html#s3-arguments"><i class="fa fa-check"></i><b>13.4.3</b> Creating methods</a></li>
<li class="chapter" data-level="13.4.4" data-path="s3.html"><a href="s3.html#exercises-38"><i class="fa fa-check"></i><b>13.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="s3.html"><a href="s3.html#object-styles"><i class="fa fa-check"></i><b>13.5</b> Object styles</a><ul>
<li class="chapter" data-level="13.5.1" data-path="s3.html"><a href="s3.html#exercises-39"><i class="fa fa-check"></i><b>13.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="s3.html"><a href="s3.html#s3-inheritance"><i class="fa fa-check"></i><b>13.6</b> Inheritance</a><ul>
<li class="chapter" data-level="13.6.1" data-path="s3.html"><a href="s3.html#nextmethod"><i class="fa fa-check"></i><b>13.6.1</b> <code>NextMethod()</code></a></li>
<li class="chapter" data-level="13.6.2" data-path="s3.html"><a href="s3.html#s3-subclassing"><i class="fa fa-check"></i><b>13.6.2</b> Allowing subclassing</a></li>
<li class="chapter" data-level="13.6.3" data-path="s3.html"><a href="s3.html#exercises-40"><i class="fa fa-check"></i><b>13.6.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="s3.html"><a href="s3.html#s3-dispatch"><i class="fa fa-check"></i><b>13.7</b> Dispatch details</a><ul>
<li class="chapter" data-level="13.7.1" data-path="s3.html"><a href="s3.html#implicit-class"><i class="fa fa-check"></i><b>13.7.1</b> S3 and base types</a></li>
<li class="chapter" data-level="13.7.2" data-path="s3.html"><a href="s3.html#internal-generics"><i class="fa fa-check"></i><b>13.7.2</b> Internal generics</a></li>
<li class="chapter" data-level="13.7.3" data-path="s3.html"><a href="s3.html#group-generics"><i class="fa fa-check"></i><b>13.7.3</b> Group generics</a></li>
<li class="chapter" data-level="13.7.4" data-path="s3.html"><a href="s3.html#double-dispatch"><i class="fa fa-check"></i><b>13.7.4</b> Double dispatch</a></li>
<li class="chapter" data-level="13.7.5" data-path="s3.html"><a href="s3.html#exercises-41"><i class="fa fa-check"></i><b>13.7.5</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="r6.html"><a href="r6.html"><i class="fa fa-check"></i><b>14</b> R6</a><ul>
<li class="chapter" data-level="14.1" data-path="r6.html"><a href="r6.html#introduction-12"><i class="fa fa-check"></i><b>14.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="r6.html"><a href="r6.html#outline-10"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="r6.html"><a href="r6.html#prerequisites-7"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="r6.html"><a href="r6.html#r6-classes"><i class="fa fa-check"></i><b>14.2</b> Classes and methods</a><ul>
<li class="chapter" data-level="14.2.1" data-path="r6.html"><a href="r6.html#method-chaining"><i class="fa fa-check"></i><b>14.2.1</b> Method chaining</a></li>
<li class="chapter" data-level="14.2.2" data-path="r6.html"><a href="r6.html#important-methods"><i class="fa fa-check"></i><b>14.2.2</b> Important methods</a></li>
<li class="chapter" data-level="14.2.3" data-path="r6.html"><a href="r6.html#adding-methods-after-creation"><i class="fa fa-check"></i><b>14.2.3</b> Adding methods after creation</a></li>
<li class="chapter" data-level="14.2.4" data-path="r6.html"><a href="r6.html#inheritance"><i class="fa fa-check"></i><b>14.2.4</b> Inheritance</a></li>
<li class="chapter" data-level="14.2.5" data-path="r6.html"><a href="r6.html#introspection"><i class="fa fa-check"></i><b>14.2.5</b> Introspection</a></li>
<li class="chapter" data-level="14.2.6" data-path="r6.html"><a href="r6.html#exercises-42"><i class="fa fa-check"></i><b>14.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="r6.html"><a href="r6.html#r6-access"><i class="fa fa-check"></i><b>14.3</b> Controlling access</a><ul>
<li class="chapter" data-level="14.3.1" data-path="r6.html"><a href="r6.html#privacy"><i class="fa fa-check"></i><b>14.3.1</b> Privacy</a></li>
<li class="chapter" data-level="14.3.2" data-path="r6.html"><a href="r6.html#active-fields"><i class="fa fa-check"></i><b>14.3.2</b> Active fields</a></li>
<li class="chapter" data-level="14.3.3" data-path="r6.html"><a href="r6.html#exercises-43"><i class="fa fa-check"></i><b>14.3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="r6.html"><a href="r6.html#r6-semantics"><i class="fa fa-check"></i><b>14.4</b> Reference semantics</a><ul>
<li class="chapter" data-level="14.4.1" data-path="r6.html"><a href="r6.html#reasoning"><i class="fa fa-check"></i><b>14.4.1</b> Reasoning</a></li>
<li class="chapter" data-level="14.4.2" data-path="r6.html"><a href="r6.html#finalizer"><i class="fa fa-check"></i><b>14.4.2</b> Finalizer</a></li>
<li class="chapter" data-level="14.4.3" data-path="r6.html"><a href="r6.html#r6-fields"><i class="fa fa-check"></i><b>14.4.3</b> R6 fields</a></li>
<li class="chapter" data-level="14.4.4" data-path="r6.html"><a href="r6.html#exercises-44"><i class="fa fa-check"></i><b>14.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="r6.html"><a href="r6.html#why-r6"><i class="fa fa-check"></i><b>14.5</b> Why R6?</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="s4.html"><a href="s4.html"><i class="fa fa-check"></i><b>15</b> S4</a><ul>
<li class="chapter" data-level="15.1" data-path="s4.html"><a href="s4.html#introduction-13"><i class="fa fa-check"></i><b>15.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="s4.html"><a href="s4.html#learning-more"><i class="fa fa-check"></i>Learning more</a></li>
<li class="chapter" data-level="" data-path="s4.html"><a href="s4.html#outline-11"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="s4.html"><a href="s4.html#prerequisites-8"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="s4.html"><a href="s4.html#s4-basics"><i class="fa fa-check"></i><b>15.2</b> Basics</a><ul>
<li class="chapter" data-level="15.2.1" data-path="s4.html"><a href="s4.html#exercises-45"><i class="fa fa-check"></i><b>15.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="s4.html"><a href="s4.html#s4-classes"><i class="fa fa-check"></i><b>15.3</b> Classes</a><ul>
<li class="chapter" data-level="15.3.1" data-path="s4.html"><a href="s4.html#inheritance-1"><i class="fa fa-check"></i><b>15.3.1</b> Inheritance</a></li>
<li class="chapter" data-level="15.3.2" data-path="s4.html"><a href="s4.html#redefinition"><i class="fa fa-check"></i><b>15.3.2</b> Redefinition</a></li>
<li class="chapter" data-level="15.3.3" data-path="s4.html"><a href="s4.html#helper"><i class="fa fa-check"></i><b>15.3.3</b> Helper</a></li>
<li class="chapter" data-level="15.3.4" data-path="s4.html"><a href="s4.html#validator"><i class="fa fa-check"></i><b>15.3.4</b> Validator</a></li>
<li class="chapter" data-level="15.3.5" data-path="s4.html"><a href="s4.html#introspection-1"><i class="fa fa-check"></i><b>15.3.5</b> Introspection</a></li>
<li class="chapter" data-level="15.3.6" data-path="s4.html"><a href="s4.html#exercises-46"><i class="fa fa-check"></i><b>15.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="s4.html"><a href="s4.html#s4-generics"><i class="fa fa-check"></i><b>15.4</b> Generics and methods</a><ul>
<li class="chapter" data-level="15.4.1" data-path="s4.html"><a href="s4.html#signature"><i class="fa fa-check"></i><b>15.4.1</b> Signature</a></li>
<li class="chapter" data-level="15.4.2" data-path="s4.html"><a href="s4.html#methods"><i class="fa fa-check"></i><b>15.4.2</b> Methods</a></li>
<li class="chapter" data-level="15.4.3" data-path="s4.html"><a href="s4.html#show-method"><i class="fa fa-check"></i><b>15.4.3</b> Show method</a></li>
<li class="chapter" data-level="15.4.4" data-path="s4.html"><a href="s4.html#accessors"><i class="fa fa-check"></i><b>15.4.4</b> Accessors</a></li>
<li class="chapter" data-level="15.4.5" data-path="s4.html"><a href="s4.html#introspection-2"><i class="fa fa-check"></i><b>15.4.5</b> Introspection</a></li>
<li class="chapter" data-level="15.4.6" data-path="s4.html"><a href="s4.html#exercises-47"><i class="fa fa-check"></i><b>15.4.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="s4.html"><a href="s4.html#s4-dispatch"><i class="fa fa-check"></i><b>15.5</b> Method dispatch</a><ul>
<li class="chapter" data-level="15.5.1" data-path="s4.html"><a href="s4.html#single-dispatch"><i class="fa fa-check"></i><b>15.5.1</b> Single dispatch</a></li>
<li class="chapter" data-level="15.5.2" data-path="s4.html"><a href="s4.html#multiple-inheritance"><i class="fa fa-check"></i><b>15.5.2</b> Multiple inheritance</a></li>
<li class="chapter" data-level="15.5.3" data-path="s4.html"><a href="s4.html#multiple-dispatch"><i class="fa fa-check"></i><b>15.5.3</b> Multiple dispatch</a></li>
<li class="chapter" data-level="15.5.4" data-path="s4.html"><a href="s4.html#multiple-dispatch-and-multiple-inheritance"><i class="fa fa-check"></i><b>15.5.4</b> Multiple dispatch and multiple inheritance</a></li>
<li class="chapter" data-level="15.5.5" data-path="s4.html"><a href="s4.html#exercises-48"><i class="fa fa-check"></i><b>15.5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.6" data-path="s4.html"><a href="s4.html#s4-s3"><i class="fa fa-check"></i><b>15.6</b> S4 and S3</a><ul>
<li class="chapter" data-level="15.6.1" data-path="s4.html"><a href="s4.html#classes"><i class="fa fa-check"></i><b>15.6.1</b> Classes</a></li>
<li class="chapter" data-level="15.6.2" data-path="s4.html"><a href="s4.html#generics"><i class="fa fa-check"></i><b>15.6.2</b> Generics</a></li>
<li class="chapter" data-level="15.6.3" data-path="s4.html"><a href="s4.html#exercises-49"><i class="fa fa-check"></i><b>15.6.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html"><i class="fa fa-check"></i><b>16</b> Trade-offs</a><ul>
<li class="chapter" data-level="16.1" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#introduction-14"><i class="fa fa-check"></i><b>16.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#outline-12"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#s3-s4"><i class="fa fa-check"></i><b>16.2</b> S4 vs S3</a></li>
<li class="chapter" data-level="16.3" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#s3-r6"><i class="fa fa-check"></i><b>16.3</b> R6 vs S3</a><ul>
<li class="chapter" data-level="16.3.1" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#namespacing"><i class="fa fa-check"></i><b>16.3.1</b> Namespacing</a></li>
<li class="chapter" data-level="16.3.2" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#threading-state"><i class="fa fa-check"></i><b>16.3.2</b> Threading state</a></li>
<li class="chapter" data-level="16.3.3" data-path="oo-tradeoffs.html"><a href="oo-tradeoffs.html#tradeoffs-pipe"><i class="fa fa-check"></i><b>16.3.3</b> Method chaining</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Metaprogramming</b></span></li>
<li class="chapter" data-level="" data-path="meta.html"><a href="meta.html"><i class="fa fa-check"></i>Introduction</a><ul>
<li class="chapter" data-level="" data-path="meta.html"><a href="meta.html#overview-1"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="16.4" data-path="meta.html"><a href="meta.html#big-ideas"><i class="fa fa-check"></i><b>16.4</b> Big ideas</a><ul>
<li class="chapter" data-level="16.4.1" data-path="meta.html"><a href="meta.html#code-is-data"><i class="fa fa-check"></i><b>16.4.1</b> Code is data</a></li>
<li class="chapter" data-level="16.4.2" data-path="meta.html"><a href="meta.html#code-is-a-tree"><i class="fa fa-check"></i><b>16.4.2</b> Code is a tree</a></li>
<li class="chapter" data-level="16.4.3" data-path="meta.html"><a href="meta.html#code-can-generate-code"><i class="fa fa-check"></i><b>16.4.3</b> Code can generate code</a></li>
<li class="chapter" data-level="16.4.4" data-path="meta.html"><a href="meta.html#executing-code-requires-an-environment"><i class="fa fa-check"></i><b>16.4.4</b> Executing code requires an environment</a></li>
<li class="chapter" data-level="16.4.5" data-path="meta.html"><a href="meta.html#code-is-accompanied-by-environments"><i class="fa fa-check"></i><b>16.4.5</b> Code is accompanied by environments</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="expressions.html"><a href="expressions.html"><i class="fa fa-check"></i><b>17</b> Expressions</a><ul>
<li class="chapter" data-level="17.1" data-path="expressions.html"><a href="expressions.html#introduction-15"><i class="fa fa-check"></i><b>17.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="expressions.html"><a href="expressions.html#outline-13"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="expressions.html"><a href="expressions.html#prerequisites-9"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="expressions.html"><a href="expressions.html#abstract-syntax-trees"><i class="fa fa-check"></i><b>17.2</b> Abstract syntax trees</a><ul>
<li class="chapter" data-level="17.2.1" data-path="expressions.html"><a href="expressions.html#infix-vs.prefix-calls"><i class="fa fa-check"></i><b>17.2.1</b> Infix vs. prefix calls</a></li>
<li class="chapter" data-level="17.2.2" data-path="expressions.html"><a href="expressions.html#function-factories-1"><i class="fa fa-check"></i><b>17.2.2</b> Function factories</a></li>
<li class="chapter" data-level="17.2.3" data-path="expressions.html"><a href="expressions.html#argument-names-1"><i class="fa fa-check"></i><b>17.2.3</b> Argument names</a></li>
<li class="chapter" data-level="17.2.4" data-path="expressions.html"><a href="expressions.html#exercises-50"><i class="fa fa-check"></i><b>17.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="expressions.html"><a href="expressions.html#grammar"><i class="fa fa-check"></i><b>17.3</b> R’s grammar</a><ul>
<li class="chapter" data-level="17.3.1" data-path="expressions.html"><a href="expressions.html#operator-precedence"><i class="fa fa-check"></i><b>17.3.1</b> Operator precedence</a></li>
<li class="chapter" data-level="17.3.2" data-path="expressions.html"><a href="expressions.html#associativity"><i class="fa fa-check"></i><b>17.3.2</b> Associativity</a></li>
<li class="chapter" data-level="17.3.3" data-path="expressions.html"><a href="expressions.html#whitespace"><i class="fa fa-check"></i><b>17.3.3</b> Whitespace</a></li>
<li class="chapter" data-level="17.3.4" data-path="expressions.html"><a href="expressions.html#exercises-51"><i class="fa fa-check"></i><b>17.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="expressions.html"><a href="expressions.html#data-structures"><i class="fa fa-check"></i><b>17.4</b> Data structures</a><ul>
<li class="chapter" data-level="17.4.1" data-path="expressions.html"><a href="expressions.html#definitions"><i class="fa fa-check"></i><b>17.4.1</b> Definitions</a></li>
<li class="chapter" data-level="17.4.2" data-path="expressions.html"><a href="expressions.html#constants"><i class="fa fa-check"></i><b>17.4.2</b> Constants</a></li>
<li class="chapter" data-level="17.4.3" data-path="expressions.html"><a href="expressions.html#symbols"><i class="fa fa-check"></i><b>17.4.3</b> Symbols</a></li>
<li class="chapter" data-level="17.4.4" data-path="expressions.html"><a href="expressions.html#calls"><i class="fa fa-check"></i><b>17.4.4</b> Calls</a></li>
<li class="chapter" data-level="17.4.5" data-path="expressions.html"><a href="expressions.html#pairlists"><i class="fa fa-check"></i><b>17.4.5</b> Pairlists</a></li>
<li class="chapter" data-level="17.4.6" data-path="expressions.html"><a href="expressions.html#expression-objects"><i class="fa fa-check"></i><b>17.4.6</b> Expression objects</a></li>
<li class="chapter" data-level="17.4.7" data-path="expressions.html"><a href="expressions.html#exercises-52"><i class="fa fa-check"></i><b>17.4.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="expressions.html"><a href="expressions.html#parsing-and-deparsing"><i class="fa fa-check"></i><b>17.5</b> Parsing and deparsing</a><ul>
<li class="chapter" data-level="17.5.1" data-path="expressions.html"><a href="expressions.html#exercises-53"><i class="fa fa-check"></i><b>17.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="17.6" data-path="expressions.html"><a href="expressions.html#ast-funs"><i class="fa fa-check"></i><b>17.6</b> Case study: Walking the AST with recursive functions</a><ul>
<li class="chapter" data-level="17.6.1" data-path="expressions.html"><a href="expressions.html#finding-f-and-t"><i class="fa fa-check"></i><b>17.6.1</b> Finding F and T</a></li>
<li class="chapter" data-level="17.6.2" data-path="expressions.html"><a href="expressions.html#finding-all-variables-created-by-assignment"><i class="fa fa-check"></i><b>17.6.2</b> Finding all variables created by assignment</a></li>
<li class="chapter" data-level="17.6.3" data-path="expressions.html"><a href="expressions.html#exercises-54"><i class="fa fa-check"></i><b>17.6.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="quasiquotation.html"><a href="quasiquotation.html"><i class="fa fa-check"></i><b>18</b> Quasiquotation</a><ul>
<li class="chapter" data-level="18.1" data-path="quasiquotation.html"><a href="quasiquotation.html#introduction-16"><i class="fa fa-check"></i><b>18.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="quasiquotation.html"><a href="quasiquotation.html#outline-14"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="quasiquotation.html"><a href="quasiquotation.html#prerequisites-10"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="quasiquotation.html"><a href="quasiquotation.html#motivation-1"><i class="fa fa-check"></i><b>18.2</b> Motivation</a><ul>
<li class="chapter" data-level="18.2.1" data-path="quasiquotation.html"><a href="quasiquotation.html#vocabulary"><i class="fa fa-check"></i><b>18.2.1</b> Vocabulary</a></li>
<li class="chapter" data-level="18.2.2" data-path="quasiquotation.html"><a href="quasiquotation.html#theory"><i class="fa fa-check"></i><b>18.2.2</b> Theory</a></li>
<li class="chapter" data-level="18.2.3" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-55"><i class="fa fa-check"></i><b>18.2.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="quasiquotation.html"><a href="quasiquotation.html#quotation"><i class="fa fa-check"></i><b>18.3</b> Quotation</a><ul>
<li class="chapter" data-level="18.3.1" data-path="quasiquotation.html"><a href="quasiquotation.html#with-rlang"><i class="fa fa-check"></i><b>18.3.1</b> With rlang</a></li>
<li class="chapter" data-level="18.3.2" data-path="quasiquotation.html"><a href="quasiquotation.html#with-base-r"><i class="fa fa-check"></i><b>18.3.2</b> With base R</a></li>
<li class="chapter" data-level="18.3.3" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-56"><i class="fa fa-check"></i><b>18.3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="quasiquotation.html"><a href="quasiquotation.html#eval-basics"><i class="fa fa-check"></i><b>18.4</b> Evaluation</a></li>
<li class="chapter" data-level="18.5" data-path="quasiquotation.html"><a href="quasiquotation.html#unquotation"><i class="fa fa-check"></i><b>18.5</b> Unquotation</a><ul>
<li class="chapter" data-level="18.5.1" data-path="quasiquotation.html"><a href="quasiquotation.html#with-rlang-1"><i class="fa fa-check"></i><b>18.5.1</b> With rlang</a></li>
<li class="chapter" data-level="18.5.2" data-path="quasiquotation.html"><a href="quasiquotation.html#the-polite-fiction-of"><i class="fa fa-check"></i><b>18.5.2</b> The polite fiction of <code>!!</code></a></li>
<li class="chapter" data-level="18.5.3" data-path="quasiquotation.html"><a href="quasiquotation.html#unquote-base"><i class="fa fa-check"></i><b>18.5.3</b> With base R</a></li>
<li class="chapter" data-level="18.5.4" data-path="quasiquotation.html"><a href="quasiquotation.html#non-standard-asts"><i class="fa fa-check"></i><b>18.5.4</b> Non-standard ASTs</a></li>
<li class="chapter" data-level="18.5.5" data-path="quasiquotation.html"><a href="quasiquotation.html#missing-arguments-1"><i class="fa fa-check"></i><b>18.5.5</b> Missing arguments</a></li>
<li class="chapter" data-level="18.5.6" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-57"><i class="fa fa-check"></i><b>18.5.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="quasiquotation.html"><a href="quasiquotation.html#quasi-case-studies"><i class="fa fa-check"></i><b>18.6</b> Case studies</a><ul>
<li class="chapter" data-level="18.6.1" data-path="quasiquotation.html"><a href="quasiquotation.html#map-reduce-to-generate-code"><i class="fa fa-check"></i><b>18.6.1</b> Map-reduce to generate code</a></li>
<li class="chapter" data-level="18.6.2" data-path="quasiquotation.html"><a href="quasiquotation.html#partition"><i class="fa fa-check"></i><b>18.6.2</b> Partition</a></li>
<li class="chapter" data-level="18.6.3" data-path="quasiquotation.html"><a href="quasiquotation.html#slicing-an-array"><i class="fa fa-check"></i><b>18.6.3</b> Slicing an array</a></li>
<li class="chapter" data-level="18.6.4" data-path="quasiquotation.html"><a href="quasiquotation.html#quasi-function"><i class="fa fa-check"></i><b>18.6.4</b> Creating functions</a></li>
<li class="chapter" data-level="18.6.5" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-58"><i class="fa fa-check"></i><b>18.6.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18.7" data-path="quasiquotation.html"><a href="quasiquotation.html#dot-dot-dot-..."><i class="fa fa-check"></i><b>18.7</b> Dot-dot-dot (<code>...</code>)</a><ul>
<li class="chapter" data-level="18.7.1" data-path="quasiquotation.html"><a href="quasiquotation.html#do.call"><i class="fa fa-check"></i><b>18.7.1</b> <code>do.call()</code></a></li>
<li class="chapter" data-level="18.7.2" data-path="quasiquotation.html"><a href="quasiquotation.html#the-tidyverse-approach"><i class="fa fa-check"></i><b>18.7.2</b> The tidyverse approach</a></li>
<li class="chapter" data-level="18.7.3" data-path="quasiquotation.html"><a href="quasiquotation.html#list2"><i class="fa fa-check"></i><b>18.7.3</b> <code>list2()</code></a></li>
<li class="chapter" data-level="18.7.4" data-path="quasiquotation.html"><a href="quasiquotation.html#application-invoke-and-lang"><i class="fa fa-check"></i><b>18.7.4</b> Application: <code>invoke()</code> and <code>lang()</code></a></li>
<li class="chapter" data-level="18.7.5" data-path="quasiquotation.html"><a href="quasiquotation.html#other-approaches"><i class="fa fa-check"></i><b>18.7.5</b> Other approaches</a></li>
<li class="chapter" data-level="18.7.6" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-59"><i class="fa fa-check"></i><b>18.7.6</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="19" data-path="evaluation.html"><a href="evaluation.html"><i class="fa fa-check"></i><b>19</b> Evaluation</a><ul>
<li class="chapter" data-level="19.1" data-path="evaluation.html"><a href="evaluation.html#introduction-17"><i class="fa fa-check"></i><b>19.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="evaluation.html"><a href="evaluation.html#outline-15"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="evaluation.html"><a href="evaluation.html#prerequisites-11"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="19.2" data-path="evaluation.html"><a href="evaluation.html#eval"><i class="fa fa-check"></i><b>19.2</b> Evaluation basics</a><ul>
<li class="chapter" data-level="19.2.1" data-path="evaluation.html"><a href="evaluation.html#application-local"><i class="fa fa-check"></i><b>19.2.1</b> Application: <code>local()</code></a></li>
<li class="chapter" data-level="19.2.2" data-path="evaluation.html"><a href="evaluation.html#application-source"><i class="fa fa-check"></i><b>19.2.2</b> Application: <code>source()</code></a></li>
<li class="chapter" data-level="19.2.3" data-path="evaluation.html"><a href="evaluation.html#gotcha-function"><i class="fa fa-check"></i><b>19.2.3</b> Gotcha: <code>function()</code></a></li>
<li class="chapter" data-level="19.2.4" data-path="evaluation.html"><a href="evaluation.html#eval-frame"><i class="fa fa-check"></i><b>19.2.4</b> Advanced: environments vs. frames</a></li>
<li class="chapter" data-level="19.2.5" data-path="evaluation.html"><a href="evaluation.html#base-r"><i class="fa fa-check"></i><b>19.2.5</b> Base R</a></li>
<li class="chapter" data-level="19.2.6" data-path="evaluation.html"><a href="evaluation.html#exercises-60"><i class="fa fa-check"></i><b>19.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="evaluation.html"><a href="evaluation.html#quosures"><i class="fa fa-check"></i><b>19.3</b> Quosures</a><ul>
<li class="chapter" data-level="19.3.1" data-path="evaluation.html"><a href="evaluation.html#motivation-2"><i class="fa fa-check"></i><b>19.3.1</b> Motivation</a></li>
<li class="chapter" data-level="19.3.2" data-path="evaluation.html"><a href="evaluation.html#creating-and-manipulating"><i class="fa fa-check"></i><b>19.3.2</b> Creating and manipulating</a></li>
<li class="chapter" data-level="19.3.3" data-path="evaluation.html"><a href="evaluation.html#evaluating"><i class="fa fa-check"></i><b>19.3.3</b> Evaluating</a></li>
<li class="chapter" data-level="19.3.4" data-path="evaluation.html"><a href="evaluation.html#implementation"><i class="fa fa-check"></i><b>19.3.4</b> Implementation</a></li>
<li class="chapter" data-level="19.3.5" data-path="evaluation.html"><a href="evaluation.html#when-not-to-use-quosures"><i class="fa fa-check"></i><b>19.3.5</b> When not to use quosures</a></li>
<li class="chapter" data-level="19.3.6" data-path="evaluation.html"><a href="evaluation.html#exercises-61"><i class="fa fa-check"></i><b>19.3.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="evaluation.html"><a href="evaluation.html#tidy-evaluation"><i class="fa fa-check"></i><b>19.4</b> Tidy evaluation</a><ul>
<li class="chapter" data-level="19.4.1" data-path="evaluation.html"><a href="evaluation.html#data-masks"><i class="fa fa-check"></i><b>19.4.1</b> Data masks</a></li>
<li class="chapter" data-level="19.4.2" data-path="evaluation.html"><a href="evaluation.html#subset"><i class="fa fa-check"></i><b>19.4.2</b> Application: <code>subset()</code></a></li>
<li class="chapter" data-level="19.4.3" data-path="evaluation.html"><a href="evaluation.html#application-arrange"><i class="fa fa-check"></i><b>19.4.3</b> Application: <code>arrange()</code></a></li>
<li class="chapter" data-level="19.4.4" data-path="evaluation.html"><a href="evaluation.html#ambiguity-and-pronouns"><i class="fa fa-check"></i><b>19.4.4</b> Ambiguity and pronouns</a></li>
<li class="chapter" data-level="19.4.5" data-path="evaluation.html"><a href="evaluation.html#base-subset"><i class="fa fa-check"></i><b>19.4.5</b> Base <code>subset()</code></a></li>
<li class="chapter" data-level="19.4.6" data-path="evaluation.html"><a href="evaluation.html#tidy-eval-performance"><i class="fa fa-check"></i><b>19.4.6</b> Performance</a></li>
<li class="chapter" data-level="19.4.7" data-path="evaluation.html"><a href="evaluation.html#exercises-62"><i class="fa fa-check"></i><b>19.4.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="evaluation.html"><a href="evaluation.html#wrapping-quoting-functions"><i class="fa fa-check"></i><b>19.5</b> Wrapping quoting functions</a><ul>
<li class="chapter" data-level="19.5.1" data-path="evaluation.html"><a href="evaluation.html#tidy-evaluation-1"><i class="fa fa-check"></i><b>19.5.1</b> Tidy evaluation</a></li>
<li class="chapter" data-level="19.5.2" data-path="evaluation.html"><a href="evaluation.html#base-r-1"><i class="fa fa-check"></i><b>19.5.2</b> Base R</a></li>
<li class="chapter" data-level="19.5.3" data-path="evaluation.html"><a href="evaluation.html#the-evaluation-environment"><i class="fa fa-check"></i><b>19.5.3</b> The evaluation environment</a></li>
<li class="chapter" data-level="19.5.4" data-path="evaluation.html"><a href="evaluation.html#making-formulas"><i class="fa fa-check"></i><b>19.5.4</b> Making formulas</a></li>
<li class="chapter" data-level="19.5.5" data-path="evaluation.html"><a href="evaluation.html#exercises-63"><i class="fa fa-check"></i><b>19.5.5</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20" data-path="translation.html"><a href="translation.html"><i class="fa fa-check"></i><b>20</b> Translating R code</a><ul>
<li class="chapter" data-level="20.1" data-path="translation.html"><a href="translation.html#introduction-18"><i class="fa fa-check"></i><b>20.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="translation.html"><a href="translation.html#outline-16"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="translation.html"><a href="translation.html#prequisites"><i class="fa fa-check"></i>Prequisites</a></li>
</ul></li>
<li class="chapter" data-level="20.2" data-path="translation.html"><a href="translation.html#html"><i class="fa fa-check"></i><b>20.2</b> HTML</a><ul>
<li class="chapter" data-level="20.2.1" data-path="translation.html"><a href="translation.html#goal"><i class="fa fa-check"></i><b>20.2.1</b> Goal</a></li>
<li class="chapter" data-level="20.2.2" data-path="translation.html"><a href="translation.html#escaping"><i class="fa fa-check"></i><b>20.2.2</b> Escaping</a></li>
<li class="chapter" data-level="20.2.3" data-path="translation.html"><a href="translation.html#basic-tag-functions"><i class="fa fa-check"></i><b>20.2.3</b> Basic tag functions</a></li>
<li class="chapter" data-level="20.2.4" data-path="translation.html"><a href="translation.html#tag-functions"><i class="fa fa-check"></i><b>20.2.4</b> Tag functions</a></li>
<li class="chapter" data-level="20.2.5" data-path="translation.html"><a href="translation.html#processing-all-tags"><i class="fa fa-check"></i><b>20.2.5</b> Processing all tags</a></li>
<li class="chapter" data-level="20.2.6" data-path="translation.html"><a href="translation.html#exercises-64"><i class="fa fa-check"></i><b>20.2.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="translation.html"><a href="translation.html#latex"><i class="fa fa-check"></i><b>20.3</b> LaTeX</a><ul>
<li class="chapter" data-level="20.3.1" data-path="translation.html"><a href="translation.html#latex-mathematics"><i class="fa fa-check"></i><b>20.3.1</b> LaTeX mathematics</a></li>
<li class="chapter" data-level="20.3.2" data-path="translation.html"><a href="translation.html#goal-1"><i class="fa fa-check"></i><b>20.3.2</b> Goal</a></li>
<li class="chapter" data-level="20.3.3" data-path="translation.html"><a href="translation.html#to_math"><i class="fa fa-check"></i><b>20.3.3</b> <code>to_math</code></a></li>
<li class="chapter" data-level="20.3.4" data-path="translation.html"><a href="translation.html#known-symbols"><i class="fa fa-check"></i><b>20.3.4</b> Known symbols</a></li>
<li class="chapter" data-level="20.3.5" data-path="translation.html"><a href="translation.html#unknown-symbols"><i class="fa fa-check"></i><b>20.3.5</b> Unknown symbols</a></li>
<li class="chapter" data-level="20.3.6" data-path="translation.html"><a href="translation.html#known-functions"><i class="fa fa-check"></i><b>20.3.6</b> Known functions</a></li>
<li class="chapter" data-level="20.3.7" data-path="translation.html"><a href="translation.html#unknown-functions"><i class="fa fa-check"></i><b>20.3.7</b> Unknown functions</a></li>
<li class="chapter" data-level="20.3.8" data-path="translation.html"><a href="translation.html#exercises-65"><i class="fa fa-check"></i><b>20.3.8</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>V Techniques</b></span></li>
<li class="chapter" data-level="21" data-path="debugging.html"><a href="debugging.html"><i class="fa fa-check"></i><b>21</b> Debugging</a><ul>
<li class="chapter" data-level="21.1" data-path="debugging.html"><a href="debugging.html#introduction-19"><i class="fa fa-check"></i><b>21.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="debugging.html"><a href="debugging.html#outline-17"><i class="fa fa-check"></i>Outline</a></li>
</ul></li>
<li class="chapter" data-level="21.2" data-path="debugging.html"><a href="debugging.html#debugging-techniques"><i class="fa fa-check"></i><b>21.2</b> Techniques</a></li>
<li class="chapter" data-level="21.3" data-path="debugging.html"><a href="debugging.html#debugging-tools"><i class="fa fa-check"></i><b>21.3</b> Tools</a><ul>
<li class="chapter" data-level="21.3.1" data-path="debugging.html"><a href="debugging.html#determining-the-sequence-of-calls"><i class="fa fa-check"></i><b>21.3.1</b> Determining the sequence of calls</a></li>
<li class="chapter" data-level="21.3.2" data-path="debugging.html"><a href="debugging.html#browsing-on-error"><i class="fa fa-check"></i><b>21.3.2</b> Browsing on error</a></li>
<li class="chapter" data-level="21.3.3" data-path="debugging.html"><a href="debugging.html#browsing-arbitrary-code"><i class="fa fa-check"></i><b>21.3.3</b> Browsing arbitrary code</a></li>
<li class="chapter" data-level="21.3.4" data-path="debugging.html"><a href="debugging.html#the-call-stack-traceback-where-and-recover"><i class="fa fa-check"></i><b>21.3.4</b> The call stack: <code>traceback()</code>, <code>where</code>, and <code>recover()</code></a></li>
<li class="chapter" data-level="21.3.5" data-path="debugging.html"><a href="debugging.html#other-types-of-failure"><i class="fa fa-check"></i><b>21.3.5</b> Other types of failure</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="22" data-path="performance.html"><a href="performance.html"><i class="fa fa-check"></i><b>22</b> Performance</a><ul>
<li class="chapter" data-level="22.1" data-path="performance.html"><a href="performance.html#why-is-r-slow"><i class="fa fa-check"></i><b>22.1</b> Why is R slow?</a></li>
<li class="chapter" data-level="22.2" data-path="performance.html"><a href="performance.html#microbenchmarking"><i class="fa fa-check"></i><b>22.2</b> Microbenchmarking</a><ul>
<li class="chapter" data-level="22.2.1" data-path="performance.html"><a href="performance.html#exercises-66"><i class="fa fa-check"></i><b>22.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="22.3" data-path="performance.html"><a href="performance.html#language-performance"><i class="fa fa-check"></i><b>22.3</b> Language performance</a><ul>
<li class="chapter" data-level="22.3.1" data-path="performance.html"><a href="performance.html#extreme-dynamism"><i class="fa fa-check"></i><b>22.3.1</b> Extreme dynamism</a></li>
<li class="chapter" data-level="22.3.2" data-path="performance.html"><a href="performance.html#name-lookup-with-mutable-environments"><i class="fa fa-check"></i><b>22.3.2</b> Name lookup with mutable environments</a></li>
<li class="chapter" data-level="22.3.3" data-path="performance.html"><a href="performance.html#lazy-evaluation-overhead"><i class="fa fa-check"></i><b>22.3.3</b> Lazy evaluation overhead</a></li>
<li class="chapter" data-level="22.3.4" data-path="performance.html"><a href="performance.html#exercises-67"><i class="fa fa-check"></i><b>22.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="22.4" data-path="performance.html"><a href="performance.html#implementation-performance"><i class="fa fa-check"></i><b>22.4</b> Implementation performance</a><ul>
<li class="chapter" data-level="22.4.1" data-path="performance.html"><a href="performance.html#extracting-a-single-value-from-a-data-frame"><i class="fa fa-check"></i><b>22.4.1</b> Extracting a single value from a data frame</a></li>
<li class="chapter" data-level="22.4.2" data-path="performance.html"><a href="performance.html#ifelse-pmin-and-pmax"><i class="fa fa-check"></i><b>22.4.2</b> <code>ifelse()</code>, <code>pmin()</code>, and <code>pmax()</code></a></li>
<li class="chapter" data-level="22.4.3" data-path="performance.html"><a href="performance.html#exercises-68"><i class="fa fa-check"></i><b>22.4.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="22.5" data-path="performance.html"><a href="performance.html#faster-r"><i class="fa fa-check"></i><b>22.5</b> Alternative R implementations</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="profiling.html"><a href="profiling.html"><i class="fa fa-check"></i><b>23</b> Optimising code</a><ul>
<li class="chapter" data-level="23.1" data-path="profiling.html"><a href="profiling.html#introduction-20"><i class="fa fa-check"></i><b>23.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="profiling.html"><a href="profiling.html#outline-18"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="profiling.html"><a href="profiling.html#prerequisites-12"><i class="fa fa-check"></i>Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="23.2" data-path="profiling.html"><a href="profiling.html#measure-perf"><i class="fa fa-check"></i><b>23.2</b> Measuring performance</a><ul>
<li class="chapter" data-level="23.2.1" data-path="profiling.html"><a href="profiling.html#limitations"><i class="fa fa-check"></i><b>23.2.1</b> Limitations</a></li>
</ul></li>
<li class="chapter" data-level="23.3" data-path="profiling.html"><a href="profiling.html#memory-profiling"><i class="fa fa-check"></i><b>23.3</b> Memory profiling with lineprof</a><ul>
<li class="chapter" data-level="23.3.1" data-path="profiling.html"><a href="profiling.html#exercises-69"><i class="fa fa-check"></i><b>23.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="23.4" data-path="profiling.html"><a href="profiling.html#improve-perf"><i class="fa fa-check"></i><b>23.4</b> Improving performance</a></li>
<li class="chapter" data-level="23.5" data-path="profiling.html"><a href="profiling.html#code-organisation"><i class="fa fa-check"></i><b>23.5</b> Code organisation</a></li>
<li class="chapter" data-level="23.6" data-path="profiling.html"><a href="profiling.html#already-solved"><i class="fa fa-check"></i><b>23.6</b> Has someone already solved the problem?</a><ul>
<li class="chapter" data-level="23.6.1" data-path="profiling.html"><a href="profiling.html#exercises-70"><i class="fa fa-check"></i><b>23.6.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="23.7" data-path="profiling.html"><a href="profiling.html#be-lazy"><i class="fa fa-check"></i><b>23.7</b> Do as little as possible</a><ul>
<li class="chapter" data-level="23.7.1" data-path="profiling.html"><a href="profiling.html#exercises-71"><i class="fa fa-check"></i><b>23.7.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="23.8" data-path="profiling.html"><a href="profiling.html#vectorise"><i class="fa fa-check"></i><b>23.8</b> Vectorise</a><ul>
<li class="chapter" data-level="23.8.1" data-path="profiling.html"><a href="profiling.html#exercises-72"><i class="fa fa-check"></i><b>23.8.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="23.9" data-path="profiling.html"><a href="profiling.html#avoid-copies"><i class="fa fa-check"></i><b>23.9</b> Avoid copies</a></li>
<li class="chapter" data-level="23.10" data-path="profiling.html"><a href="profiling.html#byte-code"><i class="fa fa-check"></i><b>23.10</b> Byte code compilation</a></li>
<li class="chapter" data-level="23.11" data-path="profiling.html"><a href="profiling.html#t-test"><i class="fa fa-check"></i><b>23.11</b> Case study: t-test</a></li>
<li class="chapter" data-level="23.12" data-path="profiling.html"><a href="profiling.html#parallelise"><i class="fa fa-check"></i><b>23.12</b> Parallelise</a></li>
<li class="chapter" data-level="23.13" data-path="profiling.html"><a href="profiling.html#more-techniques"><i class="fa fa-check"></i><b>23.13</b> Other techniques</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="rcpp.html"><a href="rcpp.html"><i class="fa fa-check"></i><b>24</b> Rewriting R code in C++</a><ul>
<li class="chapter" data-level="24.1" data-path="rcpp.html"><a href="rcpp.html#introduction-21"><i class="fa fa-check"></i><b>24.1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="rcpp.html"><a href="rcpp.html#outline-19"><i class="fa fa-check"></i>Outline</a></li>
<li class="chapter" data-level="" data-path="rcpp.html"><a href="rcpp.html#prerequistes"><i class="fa fa-check"></i>Prerequistes</a></li>
</ul></li>
<li class="chapter" data-level="24.2" data-path="rcpp.html"><a href="rcpp.html#rcpp-intro"><i class="fa fa-check"></i><b>24.2</b> Getting started with C++</a><ul>
<li class="chapter" data-level="24.2.1" data-path="rcpp.html"><a href="rcpp.html#no-inputs-scalar-output"><i class="fa fa-check"></i><b>24.2.1</b> No inputs, scalar output</a></li>
<li class="chapter" data-level="24.2.2" data-path="rcpp.html"><a href="rcpp.html#scalar-input-scalar-output"><i class="fa fa-check"></i><b>24.2.2</b> Scalar input, scalar output</a></li>
<li class="chapter" data-level="24.2.3" data-path="rcpp.html"><a href="rcpp.html#vector-input-scalar-output"><i class="fa fa-check"></i><b>24.2.3</b> Vector input, scalar output</a></li>
<li class="chapter" data-level="24.2.4" data-path="rcpp.html"><a href="rcpp.html#vector-input-vector-output"><i class="fa fa-check"></i><b>24.2.4</b> Vector input, vector output</a></li>
<li class="chapter" data-level="24.2.5" data-path="rcpp.html"><a href="rcpp.html#matrix-input-vector-output"><i class="fa fa-check"></i><b>24.2.5</b> Matrix input, vector output</a></li>
<li class="chapter" data-level="24.2.6" data-path="rcpp.html"><a href="rcpp.html#sourceCpp"><i class="fa fa-check"></i><b>24.2.6</b> Using sourceCpp</a></li>
<li class="chapter" data-level="24.2.7" data-path="rcpp.html"><a href="rcpp.html#exercises-73"><i class="fa fa-check"></i><b>24.2.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.3" data-path="rcpp.html"><a href="rcpp.html#rcpp-classes"><i class="fa fa-check"></i><b>24.3</b> Attributes and other classes</a><ul>
<li class="chapter" data-level="24.3.1" data-path="rcpp.html"><a href="rcpp.html#lists-and-data-frames"><i class="fa fa-check"></i><b>24.3.1</b> Lists and data frames</a></li>
<li class="chapter" data-level="24.3.2" data-path="rcpp.html"><a href="rcpp.html#functions-rcpp"><i class="fa fa-check"></i><b>24.3.2</b> Functions</a></li>
<li class="chapter" data-level="24.3.3" data-path="rcpp.html"><a href="rcpp.html#other-types"><i class="fa fa-check"></i><b>24.3.3</b> Other types</a></li>
</ul></li>
<li class="chapter" data-level="24.4" data-path="rcpp.html"><a href="rcpp.html#rcpp-na"><i class="fa fa-check"></i><b>24.4</b> Missing values</a><ul>
<li class="chapter" data-level="24.4.1" data-path="rcpp.html"><a href="rcpp.html#scalars-1"><i class="fa fa-check"></i><b>24.4.1</b> Scalars</a></li>
<li class="chapter" data-level="24.4.2" data-path="rcpp.html"><a href="rcpp.html#strings"><i class="fa fa-check"></i><b>24.4.2</b> Strings</a></li>
<li class="chapter" data-level="24.4.3" data-path="rcpp.html"><a href="rcpp.html#boolean"><i class="fa fa-check"></i><b>24.4.3</b> Boolean</a></li>
<li class="chapter" data-level="24.4.4" data-path="rcpp.html"><a href="rcpp.html#vectors-rcpp"><i class="fa fa-check"></i><b>24.4.4</b> Vectors</a></li>
<li class="chapter" data-level="24.4.5" data-path="rcpp.html"><a href="rcpp.html#exercises-74"><i class="fa fa-check"></i><b>24.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.5" data-path="rcpp.html"><a href="rcpp.html#rcpp-sugar"><i class="fa fa-check"></i><b>24.5</b> Rcpp sugar</a><ul>
<li class="chapter" data-level="24.5.1" data-path="rcpp.html"><a href="rcpp.html#arithmetic-and-logical-operators"><i class="fa fa-check"></i><b>24.5.1</b> Arithmetic and logical operators</a></li>
<li class="chapter" data-level="24.5.2" data-path="rcpp.html"><a href="rcpp.html#logical-summary-functions"><i class="fa fa-check"></i><b>24.5.2</b> Logical summary functions</a></li>
<li class="chapter" data-level="24.5.3" data-path="rcpp.html"><a href="rcpp.html#vector-views"><i class="fa fa-check"></i><b>24.5.3</b> Vector views</a></li>
<li class="chapter" data-level="24.5.4" data-path="rcpp.html"><a href="rcpp.html#other-useful-functions"><i class="fa fa-check"></i><b>24.5.4</b> Other useful functions</a></li>
</ul></li>
<li class="chapter" data-level="24.6" data-path="rcpp.html"><a href="rcpp.html#stl"><i class="fa fa-check"></i><b>24.6</b> The STL</a><ul>
<li class="chapter" data-level="24.6.1" data-path="rcpp.html"><a href="rcpp.html#using-iterators"><i class="fa fa-check"></i><b>24.6.1</b> Using iterators</a></li>
<li class="chapter" data-level="24.6.2" data-path="rcpp.html"><a href="rcpp.html#algorithms"><i class="fa fa-check"></i><b>24.6.2</b> Algorithms</a></li>
<li class="chapter" data-level="24.6.3" data-path="rcpp.html"><a href="rcpp.html#data-structures-rcpp"><i class="fa fa-check"></i><b>24.6.3</b> Data structures</a></li>
<li class="chapter" data-level="24.6.4" data-path="rcpp.html"><a href="rcpp.html#vectors-stl"><i class="fa fa-check"></i><b>24.6.4</b> Vectors</a></li>
<li class="chapter" data-level="24.6.5" data-path="rcpp.html"><a href="rcpp.html#sets"><i class="fa fa-check"></i><b>24.6.5</b> Sets</a></li>
<li class="chapter" data-level="24.6.6" data-path="rcpp.html"><a href="rcpp.html#map-1"><i class="fa fa-check"></i><b>24.6.6</b> Map</a></li>
<li class="chapter" data-level="24.6.7" data-path="rcpp.html"><a href="rcpp.html#exercises-75"><i class="fa fa-check"></i><b>24.6.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.7" data-path="rcpp.html"><a href="rcpp.html#rcpp-case-studies"><i class="fa fa-check"></i><b>24.7</b> Case studies</a><ul>
<li class="chapter" data-level="24.7.1" data-path="rcpp.html"><a href="rcpp.html#gibbs-sampler"><i class="fa fa-check"></i><b>24.7.1</b> Gibbs sampler</a></li>
<li class="chapter" data-level="24.7.2" data-path="rcpp.html"><a href="rcpp.html#r-vectorisation-vs.c-vectorisation"><i class="fa fa-check"></i><b>24.7.2</b> R vectorisation vs. C++ vectorisation</a></li>
</ul></li>
<li class="chapter" data-level="24.8" data-path="rcpp.html"><a href="rcpp.html#rcpp-package"><i class="fa fa-check"></i><b>24.8</b> Using Rcpp in a package</a></li>
<li class="chapter" data-level="24.9" data-path="rcpp.html"><a href="rcpp.html#rcpp-more"><i class="fa fa-check"></i><b>24.9</b> Learning more</a></li>
<li class="chapter" data-level="24.10" data-path="rcpp.html"><a href="rcpp.html#acknowledgments"><i class="fa fa-check"></i><b>24.10</b> Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown">
Proudly published with bookdown</a></li>
<li><a href="https://github.com/hadley/adv-r">Forked from Hadley</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="expressions" class="section level1">
<h1><span class="header-section-number">17</span> Expressions</h1>
<div id="introduction-15" class="section level2">
<h2><span class="header-section-number">17.1</span> Introduction</h2>
<p>To compute on the language, we first need to understand its structure. That requires some new vocabulary, some new tools, and some new ways of thinking about R code. The first thing you’ll need to understand is the distinction between an operation and its result. Take this code, which takes a variable <code>x</code>, multiplies it by 10, and saves the result to a new variable called <code>y</code>. It doesn’t work because we haven’t defined a variable called <code>x</code>:</p>
<div class="sourceCode" id="cb652"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb652-1" data-line-number="1">y &lt;-<span class="st"> </span>x <span class="op">*</span><span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb652-2" data-line-number="2"><span class="co">#&gt; Error in eval(expr, envir, enclos):</span></a>
<a class="sourceLine" id="cb652-3" data-line-number="3"><span class="co">#&gt;   object &#39;x&#39; not found</span></a></code></pre></div>
<p>It would be nice if we could capture the intent of the code, without executing the code. In other words, how can we separate our description of the action from performing it? One way is to use <code>rlang::expr()</code>:</p>
<div class="sourceCode" id="cb653"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb653-1" data-line-number="1">z &lt;-<span class="st"> </span>rlang<span class="op">::</span><span class="kw">expr</span>(y &lt;-<span class="st"> </span>x <span class="op">*</span><span class="st"> </span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb653-2" data-line-number="2">z</a>
<a class="sourceLine" id="cb653-3" data-line-number="3"><span class="co">#&gt; y &lt;- x * 10</span></a></code></pre></div>
<p><code>expr()</code> returns a quoted <strong>expression</strong>: the R code that captures our intent. We’ll com back to discussion <code>expr()</code> in depth in Section <a href="quasiquotation.html#quotation">18.3</a>. In this chapter, you’ll learn about the underlying data structure, which will also help you understand how R executes code. Later, in Section <a href="evaluation.html#eval">19.2</a>, you’ll learn about <code>eval()</code> which allows you to take such an expression and perform, or <strong>evaluate</strong>, it:</p>
<div class="sourceCode" id="cb654"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb654-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="dv">4</span></a>
<a class="sourceLine" id="cb654-2" data-line-number="2"><span class="kw">eval</span>(z)</a>
<a class="sourceLine" id="cb654-3" data-line-number="3">y</a>
<a class="sourceLine" id="cb654-4" data-line-number="4"><span class="co">#&gt; [1] 40</span></a></code></pre></div>
<div id="outline-13" class="section level3 unnumbered">
<h3>Outline</h3>
</div>
<div id="prerequisites-9" class="section level3 unnumbered">
<h3>Prerequisites</h3>
<p>You’ll need the rlang package to capture and compute on expressions, and the lobstr package to visualise them.</p>
<div class="sourceCode" id="cb655"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb655-1" data-line-number="1"><span class="kw">library</span>(rlang)</a>
<a class="sourceLine" id="cb655-2" data-line-number="2"></a>
<a class="sourceLine" id="cb655-3" data-line-number="3"><span class="co"># devtools::install_github(&quot;r-lib/lobstr&quot;)</span></a>
<a class="sourceLine" id="cb655-4" data-line-number="4"><span class="kw">library</span>(lobstr)</a></code></pre></div>
</div>
</div>
<div id="abstract-syntax-trees" class="section level2">
<h2><span class="header-section-number">17.2</span> Abstract syntax trees</h2>
<p></p>
<p>Quoted expressions are also called <strong>abstract syntax trees</strong> (ASTs) because the structure of code is hierarchical and can be naturally represented as a tree. To make that more obvious we’re going to introduce some graphical conventions, illustrated with the very simple call <code>f(x, &quot;y&quot;, 1)</code>.</p>
<p><img src="diagrams/expressions/simple.png" width="227" style="display: block; margin: auto;" /></p>
<ul>
<li><p>Function <strong>calls</strong> define the hierarchy of the tree. Calls are shown
with an orange square. The first child (<code>f</code>) is the function that gets
called; the second and subsequent children (<code>x</code>, <code>&quot;y&quot;</code>, and <code>1</code>) are the
arguments.</p>
<p><strong>NB</strong>: Unlike many trees the order of the children is important:
<code>f(x, 1)</code> is not the same as <code>f(1, x)</code>.</p></li>
<li><p>The leaves of the tree are either <strong>symbols</strong>, like <code>f</code> and <code>x</code>, or
<strong>constants</strong> like <code>1</code> or <code>&quot;y&quot;</code>. Symbols have a purple border and rounded
corners. Constants, which are atomic vectors of length one, have black
borders and square corners. Strings are always surrounded in quotes to
emphasise their difference from symbols — more on that later.</p></li>
</ul>
<p>Drawing these diagrams by hand takes me some time, and obviously you can’t rely on me to draw diagrams for your own code. I’ll supplement the hand-drawn trees with trees drawn by <code>lobstr::ast()</code>. <code>ast()</code> tries to make trees as similar as possible to my hand-drawn trees, while respecting the limitations of the console. Let’s use <code>ast()</code> to display the tree above:</p>
<div class="sourceCode" id="cb656"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb656-1" data-line-number="1">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="kw">f</span>(x, <span class="st">&quot;y&quot;</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb656-2" data-line-number="2"><span class="co">#&gt; █─f </span></a>
<a class="sourceLine" id="cb656-3" data-line-number="3"><span class="co">#&gt; ├─x </span></a>
<a class="sourceLine" id="cb656-4" data-line-number="4"><span class="co">#&gt; ├─&quot;y&quot; </span></a>
<a class="sourceLine" id="cb656-5" data-line-number="5"><span class="co">#&gt; └─1</span></a></code></pre></div>
<p>Calls get an orange square, symbols are bold and purple, and strings are surrounded by quote marks. (The colours are not shown in the book, but you’ll see it if you run the code yourself.)</p>
<p><code>ast()</code> supports “unquoting” with <code>!!</code> (pronounced bang-bang). We’ll talk about unquoting in detail in the next chapter; for now note that you’ll need it if you want to see the structure of an expression that you’ve already captured with <code>expr()</code>.</p>
<div class="sourceCode" id="cb657"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb657-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">expr</span>(<span class="kw">f</span>(x, <span class="st">&quot;y&quot;</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb657-2" data-line-number="2"></a>
<a class="sourceLine" id="cb657-3" data-line-number="3"><span class="co"># not useful!</span></a>
<a class="sourceLine" id="cb657-4" data-line-number="4">lobstr<span class="op">::</span><span class="kw">ast</span>(x)</a>
<a class="sourceLine" id="cb657-5" data-line-number="5"><span class="co">#&gt; x</span></a>
<a class="sourceLine" id="cb657-6" data-line-number="6"></a>
<a class="sourceLine" id="cb657-7" data-line-number="7"><span class="co"># what we want</span></a>
<a class="sourceLine" id="cb657-8" data-line-number="8">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="op">!!</span>x)</a>
<a class="sourceLine" id="cb657-9" data-line-number="9"><span class="co">#&gt; █─f </span></a>
<a class="sourceLine" id="cb657-10" data-line-number="10"><span class="co">#&gt; ├─x </span></a>
<a class="sourceLine" id="cb657-11" data-line-number="11"><span class="co">#&gt; ├─&quot;y&quot; </span></a>
<a class="sourceLine" id="cb657-12" data-line-number="12"><span class="co">#&gt; └─1</span></a></code></pre></div>
<p>For more complex code, you can also use RStudio’s tree viewer to explore the AST interactively, e.g. <code>View(expr(y &lt;- x * 10))</code>.</p>
<div id="infix-vs.prefix-calls" class="section level3">
<h3><span class="header-section-number">17.2.1</span> Infix vs. prefix calls</h3>
<p>Every call in R can be written in tree form, even if it doesn’t look like it at first glance. Take <code>y &lt;- x * 10</code> again: what are the functions that are being called? It is not as easy to spot as <code>f(x, 1)</code> because this expression contains two calls in <strong>infix</strong> form: <code>&lt;-</code> and <code>*</code>. Infix functions come <strong>in</strong>between their arguments (so an infix function can only have two arguments), whereas most functions in R are <strong>prefix</strong> functions where the name of the function comes first.<a href="#fn51" class="footnote-ref" id="fnref51"><sup>51</sup></a></p>
<p>As discussed in Section <a href="functions.html#prefix-form">5.8.1</a>, any call can be converted to prefix form. That means that these two lines of code are equivalent:</p>
<div class="sourceCode" id="cb658"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb658-1" data-line-number="1">y &lt;-<span class="st"> </span>x <span class="op">*</span><span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb658-2" data-line-number="2"><span class="st">`</span><span class="dt">&lt;-</span><span class="st">`</span>(y, <span class="st">`</span><span class="dt">*</span><span class="st">`</span>(x, <span class="dv">10</span>))</a></code></pre></div>
<p>And they have this AST:</p>
<p><img src="diagrams/expressions/prefix.png" width="227" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb659"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb659-1" data-line-number="1">lobstr<span class="op">::</span><span class="kw">ast</span>(y &lt;-<span class="st"> </span>x <span class="op">*</span><span class="st"> </span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb659-2" data-line-number="2"><span class="co">#&gt; █─`&lt;-` </span></a>
<a class="sourceLine" id="cb659-3" data-line-number="3"><span class="co">#&gt; ├─y </span></a>
<a class="sourceLine" id="cb659-4" data-line-number="4"><span class="co">#&gt; └─█─`*` </span></a>
<a class="sourceLine" id="cb659-5" data-line-number="5"><span class="co">#&gt;   ├─x </span></a>
<a class="sourceLine" id="cb659-6" data-line-number="6"><span class="co">#&gt;   └─10</span></a></code></pre></div>
<p>You might remember that code like <code>names(x) &lt;- y</code> ends up calling the <code>names&lt;-</code> function. That is not reflected in the parse tree because the translation needs to happen at run-time, not parse-time, due to the complexities of nested assignments like <code>names(x)[2] &lt;- &quot;z&quot;</code>.</p>
<div class="sourceCode" id="cb660"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb660-1" data-line-number="1">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="kw">names</span>(x) &lt;-<span class="st"> </span>y)</a>
<a class="sourceLine" id="cb660-2" data-line-number="2"><span class="co">#&gt; █─`&lt;-` </span></a>
<a class="sourceLine" id="cb660-3" data-line-number="3"><span class="co">#&gt; ├─█─names </span></a>
<a class="sourceLine" id="cb660-4" data-line-number="4"><span class="co">#&gt; │ └─x </span></a>
<a class="sourceLine" id="cb660-5" data-line-number="5"><span class="co">#&gt; └─y</span></a></code></pre></div>
<p>It’s informative to look at the ASTs for other special forms</p>
<div class="sourceCode" id="cb661"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb661-1" data-line-number="1">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="cf">function</span>(x, y) {</a>
<a class="sourceLine" id="cb661-2" data-line-number="2">  <span class="cf">if</span> (x <span class="op">&gt;</span><span class="st"> </span>y) {</a>
<a class="sourceLine" id="cb661-3" data-line-number="3">    x</a>
<a class="sourceLine" id="cb661-4" data-line-number="4">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb661-5" data-line-number="5">    y</a>
<a class="sourceLine" id="cb661-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb661-7" data-line-number="7">})</a>
<a class="sourceLine" id="cb661-8" data-line-number="8"><span class="co">#&gt; █─`function` </span></a>
<a class="sourceLine" id="cb661-9" data-line-number="9"><span class="co">#&gt; ├─█─x = `` </span></a>
<a class="sourceLine" id="cb661-10" data-line-number="10"><span class="co">#&gt; │ └─y = `` </span></a>
<a class="sourceLine" id="cb661-11" data-line-number="11"><span class="co">#&gt; ├─█─`{` </span></a>
<a class="sourceLine" id="cb661-12" data-line-number="12"><span class="co">#&gt; │ └─█─`if` </span></a>
<a class="sourceLine" id="cb661-13" data-line-number="13"><span class="co">#&gt; │   ├─█─`&gt;` </span></a>
<a class="sourceLine" id="cb661-14" data-line-number="14"><span class="co">#&gt; │   │ ├─x </span></a>
<a class="sourceLine" id="cb661-15" data-line-number="15"><span class="co">#&gt; │   │ └─y </span></a>
<a class="sourceLine" id="cb661-16" data-line-number="16"><span class="co">#&gt; │   ├─█─`{` </span></a>
<a class="sourceLine" id="cb661-17" data-line-number="17"><span class="co">#&gt; │   │ └─x </span></a>
<a class="sourceLine" id="cb661-18" data-line-number="18"><span class="co">#&gt; │   └─█─`{` </span></a>
<a class="sourceLine" id="cb661-19" data-line-number="19"><span class="co">#&gt; │     └─y </span></a>
<a class="sourceLine" id="cb661-20" data-line-number="20"><span class="co">#&gt; └─&lt;inline srcref&gt;</span></a></code></pre></div>
<p>Note that functions include a node <code>&lt;inline srcref&gt;</code>, this contains the source code of the function, as described in Section <a href="functions.html#function-components">5.2.2</a>.</p>
</div>
<div id="function-factories-1" class="section level3">
<h3><span class="header-section-number">17.2.2</span> Function factories</h3>
<p>Another small detail we need to consider are calls like <code>f()()</code>. The first component of the call is usually a symbol:</p>
<div class="sourceCode" id="cb662"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb662-1" data-line-number="1">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="kw">f</span>(a, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb662-2" data-line-number="2"><span class="co">#&gt; █─f </span></a>
<a class="sourceLine" id="cb662-3" data-line-number="3"><span class="co">#&gt; ├─a </span></a>
<a class="sourceLine" id="cb662-4" data-line-number="4"><span class="co">#&gt; └─1</span></a></code></pre></div>
<p>But if you are using a function factory (Chapter <a href="function-factories.html#function-factories">10</a>), a function that returns another function, the first component might be another call:</p>
<div class="sourceCode" id="cb663"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb663-1" data-line-number="1">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="kw">f</span>()(a, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb663-2" data-line-number="2"><span class="co">#&gt; █─█─f </span></a>
<a class="sourceLine" id="cb663-3" data-line-number="3"><span class="co">#&gt; ├─a </span></a>
<a class="sourceLine" id="cb663-4" data-line-number="4"><span class="co">#&gt; └─1</span></a></code></pre></div>
<p>And of course that function might also take arguments:</p>
<div class="sourceCode" id="cb664"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb664-1" data-line-number="1">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="kw">f</span>(b, <span class="dv">2</span>)(a, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb664-2" data-line-number="2"><span class="co">#&gt; █─█─f </span></a>
<a class="sourceLine" id="cb664-3" data-line-number="3"><span class="co">#&gt; │ ├─b </span></a>
<a class="sourceLine" id="cb664-4" data-line-number="4"><span class="co">#&gt; │ └─2 </span></a>
<a class="sourceLine" id="cb664-5" data-line-number="5"><span class="co">#&gt; ├─a </span></a>
<a class="sourceLine" id="cb664-6" data-line-number="6"><span class="co">#&gt; └─1</span></a></code></pre></div>
<p>These forms are relatively rare, but it’s good to be able to recognise them when they crop up.</p>
</div>
<div id="argument-names-1" class="section level3">
<h3><span class="header-section-number">17.2.3</span> Argument names</h3>
<p>So far the examples have only used unnamed arguments. Named arguments don’t change the parsing rules, but just add some additional metadata:</p>
<div class="sourceCode" id="cb665"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb665-1" data-line-number="1">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="kw">mean</span>(<span class="dt">x =</span> mtcars<span class="op">$</span>cyl, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb665-2" data-line-number="2"><span class="co">#&gt; █─mean </span></a>
<a class="sourceLine" id="cb665-3" data-line-number="3"><span class="co">#&gt; ├─x = █─`$` </span></a>
<a class="sourceLine" id="cb665-4" data-line-number="4"><span class="co">#&gt; │     ├─mtcars </span></a>
<a class="sourceLine" id="cb665-5" data-line-number="5"><span class="co">#&gt; │     └─cyl </span></a>
<a class="sourceLine" id="cb665-6" data-line-number="6"><span class="co">#&gt; └─na.rm = TRUE</span></a></code></pre></div>
<p>(Note the appearance of another infix function: <code>$</code>)</p>
</div>
<div id="exercises-50" class="section level3">
<h3><span class="header-section-number">17.2.4</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Use <code>ast()</code> and experimentation to figure out the three arguments to <code>if</code>.
What would you call them? Which arguments are required and which are
optional?</p></li>
<li><p>What does the call tree of an <code>if</code> statement with multiple <code>else if</code>
conditions look like? Why?</p></li>
<li><p>What are the arguments to the <code>for()</code> and <code>while()</code> calls?</p></li>
<li><p>Two arithmetic operators can be used in both prefix and infix style.
What are they?</p></li>
</ol>
</div>
</div>
<div id="grammar" class="section level2">
<h2><span class="header-section-number">17.3</span> R’s grammar</h2>
<p>The process by which a computer language takes a sequence of tokens (like <code>x</code>, <code>+</code>, <code>y</code>) and constructs a tree is called <strong>parsing</strong>, and it is governed by a set of rules known as a <strong>grammar</strong>. In this section, we’ll use <code>lobstr::ast()</code> to explore some of the details of R’s grammar.</p>
<p>If this is your first reading of the metaprogramming chapters, now is a good time to read the first sections of the next two chapters in order to get the big picture. Come back and learn more of the details once you’ve seen how all the big pieces fit together.</p>
<div id="operator-precedence" class="section level3">
<h3><span class="header-section-number">17.3.1</span> Operator precedence</h3>
<p>Infix functions introduce ambiguity in a way that prefix functions do not. The parser has to resolve two sources of ambiguity when parsing infix operators<a href="#fn52" class="footnote-ref" id="fnref52"><sup>52</sup></a>. First, what does <code>1 + 2 * 3</code> yield? Do you get 9 (i.e. <code>(1 + 2) * 3</code>), or 7 (i.e. <code>1 + (2 * 3)</code>)? Which of the two possible parse trees below does R use?</p>
<p><img src="diagrams/expressions/ambig-order.png" width="416" style="display: block; margin: auto;" /></p>
<p>Programming languages use conventions called <strong>operator precedence</strong> to resolve this ambiguity. We can use <code>ast()</code> to see what R does:</p>
<div class="sourceCode" id="cb666"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb666-1" data-line-number="1">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb666-2" data-line-number="2"><span class="co">#&gt; █─`+` </span></a>
<a class="sourceLine" id="cb666-3" data-line-number="3"><span class="co">#&gt; ├─1 </span></a>
<a class="sourceLine" id="cb666-4" data-line-number="4"><span class="co">#&gt; └─█─`*` </span></a>
<a class="sourceLine" id="cb666-5" data-line-number="5"><span class="co">#&gt;   ├─2 </span></a>
<a class="sourceLine" id="cb666-6" data-line-number="6"><span class="co">#&gt;   └─3</span></a></code></pre></div>
<p>Predicting the precedence of arithmetic operations is usually easy because it’s drilled into you in school and is consistent across the vast majority of programming languages. Predicting the precedence of other operators is harder. There’s one particularly surprising case in R: <code>!</code> has a much lower precedence (i.e. it binds less tightly) than you might expect. This allows you to write useful operations like:</p>
<div class="sourceCode" id="cb667"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb667-1" data-line-number="1">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="op">!</span>x <span class="op">%in%</span><span class="st"> </span>y)</a>
<a class="sourceLine" id="cb667-2" data-line-number="2"><span class="co">#&gt; █─`!` </span></a>
<a class="sourceLine" id="cb667-3" data-line-number="3"><span class="co">#&gt; └─█─`%in%` </span></a>
<a class="sourceLine" id="cb667-4" data-line-number="4"><span class="co">#&gt;   ├─x </span></a>
<a class="sourceLine" id="cb667-5" data-line-number="5"><span class="co">#&gt;   └─y</span></a></code></pre></div>
<p>R has over 30 infix operators divided into 18 precedence groups. While the details are described in <code>?Syntax</code>, very few people have memorised the complete ordering. Indeed, if there’s any confusion, use parentheses! These also appear in the AST, like all other special forms:</p>
<div class="sourceCode" id="cb668"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb668-1" data-line-number="1">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">3</span>))</a>
<a class="sourceLine" id="cb668-2" data-line-number="2"><span class="co">#&gt; █─`+` </span></a>
<a class="sourceLine" id="cb668-3" data-line-number="3"><span class="co">#&gt; ├─1 </span></a>
<a class="sourceLine" id="cb668-4" data-line-number="4"><span class="co">#&gt; └─█─`(` </span></a>
<a class="sourceLine" id="cb668-5" data-line-number="5"><span class="co">#&gt;   └─█─`+` </span></a>
<a class="sourceLine" id="cb668-6" data-line-number="6"><span class="co">#&gt;     ├─2 </span></a>
<a class="sourceLine" id="cb668-7" data-line-number="7"><span class="co">#&gt;     └─3</span></a></code></pre></div>
</div>
<div id="associativity" class="section level3">
<h3><span class="header-section-number">17.3.2</span> Associativity</h3>
<p>Another source of ambiguity is introduced by repeated usage of the same infix function. For example, is <code>1 + 2 + 3</code> equivalent to <code>(1 + 2) + 3</code> or to <code>1 + (2 + 3)</code>? This normally doesn’t matter because <code>x + (y + z) == (x + y) + z</code>, i.e. addition is associative, but is needed because some S3 classes define <code>+</code> in a non-associative way. For example, ggplot2 overloads <code>+</code> to build up a complex plot from simple pieces; this usage is non-associative because earlier layers are drawn underneath later layers.</p>
<p>In R, most operators are <strong>left-associative</strong>, i.e. the operations on the left are evaluated first:</p>
<div class="sourceCode" id="cb669"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb669-1" data-line-number="1">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb669-2" data-line-number="2"><span class="co">#&gt; █─`+` </span></a>
<a class="sourceLine" id="cb669-3" data-line-number="3"><span class="co">#&gt; ├─█─`+` </span></a>
<a class="sourceLine" id="cb669-4" data-line-number="4"><span class="co">#&gt; │ ├─1 </span></a>
<a class="sourceLine" id="cb669-5" data-line-number="5"><span class="co">#&gt; │ └─2 </span></a>
<a class="sourceLine" id="cb669-6" data-line-number="6"><span class="co">#&gt; └─3</span></a></code></pre></div>
<p>There are two exceptions: exponentiation and assignment.</p>
<div class="sourceCode" id="cb670"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb670-1" data-line-number="1">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="dv">2</span> <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">^</span><span class="st"> </span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb670-2" data-line-number="2"><span class="co">#&gt; █─`^` </span></a>
<a class="sourceLine" id="cb670-3" data-line-number="3"><span class="co">#&gt; ├─2 </span></a>
<a class="sourceLine" id="cb670-4" data-line-number="4"><span class="co">#&gt; └─█─`^` </span></a>
<a class="sourceLine" id="cb670-5" data-line-number="5"><span class="co">#&gt;   ├─2 </span></a>
<a class="sourceLine" id="cb670-6" data-line-number="6"><span class="co">#&gt;   └─3</span></a>
<a class="sourceLine" id="cb670-7" data-line-number="7">lobstr<span class="op">::</span><span class="kw">ast</span>(x &lt;-<span class="st"> </span>y &lt;-<span class="st"> </span>z)</a>
<a class="sourceLine" id="cb670-8" data-line-number="8"><span class="co">#&gt; █─`&lt;-` </span></a>
<a class="sourceLine" id="cb670-9" data-line-number="9"><span class="co">#&gt; ├─x </span></a>
<a class="sourceLine" id="cb670-10" data-line-number="10"><span class="co">#&gt; └─█─`&lt;-` </span></a>
<a class="sourceLine" id="cb670-11" data-line-number="11"><span class="co">#&gt;   ├─y </span></a>
<a class="sourceLine" id="cb670-12" data-line-number="12"><span class="co">#&gt;   └─z</span></a></code></pre></div>
</div>
<div id="whitespace" class="section level3">
<h3><span class="header-section-number">17.3.3</span> Whitespace</h3>
<p>R, in general, is not sensitive to white space. Most white space is not significant and is not recorded in the AST (this is one reason that it’s <em>abstract</em>). For example, <code>x+y</code> yields exactly the same AST as <code>x +        y</code>, and means that you’re generally free to add whitespace to enhance the readability of your code. There’s one major exception:</p>
<div class="sourceCode" id="cb671"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb671-1" data-line-number="1">lobstr<span class="op">::</span><span class="kw">ast</span>(y &lt;-<span class="st"> </span>x)</a>
<a class="sourceLine" id="cb671-2" data-line-number="2"><span class="co">#&gt; █─`&lt;-` </span></a>
<a class="sourceLine" id="cb671-3" data-line-number="3"><span class="co">#&gt; ├─y </span></a>
<a class="sourceLine" id="cb671-4" data-line-number="4"><span class="co">#&gt; └─x</span></a>
<a class="sourceLine" id="cb671-5" data-line-number="5">lobstr<span class="op">::</span><span class="kw">ast</span>(y <span class="op">&lt;</span><span class="st"> </span><span class="op">-</span>x)</a>
<a class="sourceLine" id="cb671-6" data-line-number="6"><span class="co">#&gt; █─`&lt;` </span></a>
<a class="sourceLine" id="cb671-7" data-line-number="7"><span class="co">#&gt; ├─y </span></a>
<a class="sourceLine" id="cb671-8" data-line-number="8"><span class="co">#&gt; └─█─`-` </span></a>
<a class="sourceLine" id="cb671-9" data-line-number="9"><span class="co">#&gt;   └─x</span></a></code></pre></div>
</div>
<div id="exercises-51" class="section level3">
<h3><span class="header-section-number">17.3.4</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>R uses parentheses in two slightly different ways as illustrated by
these two calls:</p>
<div class="sourceCode" id="cb672"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb672-1" data-line-number="1"><span class="kw">f</span>((<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb672-2" data-line-number="2"><span class="st">`</span><span class="dt">(</span><span class="st">`</span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<p>Compare and contrast the two uses by referencing the AST.</p></li>
<li><p><code>=</code> can also be used in two ways. Construct a simple example that shows
both uses.</p></li>
<li><p>What does <code>!1 + !1</code> return? Why?</p></li>
<li><p>Why does <code>x1 &lt;- x2 &lt;- x3 &lt;- 0</code> work? Describe the two reasons.</p></li>
<li><p>Compare the ASTs of <code>x + y %+% z</code> and <code>x ^ y %+% z</code>. What have you learned
about the precedence of custom infix functions?</p></li>
</ol>
</div>
</div>
<div id="data-structures" class="section level2">
<h2><span class="header-section-number">17.4</span> Data structures</h2>
<p>Now that you have a good feel for ASTs and how R’s grammar helps to define them, it’s time to learn about the underlying implementation. In this section you’ll learn more about the data structures that appear in the AST:</p>
<ul>
<li>Constants and symbols form the leaves of the tree.</li>
<li>Calls form the branches of the tree.</li>
<li>Pairlists are a largely historical data structure that are now only used for
function arguments.</li>
</ul>
<div id="definitions" class="section level3">
<h3><span class="header-section-number">17.4.1</span> Definitions</h3>
<p>Before we continue, a word of caution about definitions. this book. Because base R evolved organically, it does not have a set of definitions that are used consistently throughout the documetnation. The biggest source of confusion is the use of the term “expression” to mean two different things:</p>
<ul>
<li><p>The set of base types created by parsing code, i.e. constants, symbols, calls,
and pairlists.</p></li>
<li><p>The objects created by <code>expression()</code> (and <code>parse()</code>).</p></li>
</ul>
<p>In this book, I adopt the convention of the <em>R language definition</em> <span class="citation">(R Core Team <a href="#ref-r-lang">2018</a><a href="#ref-r-lang">b</a>)</span> and call the first category <strong>expressions</strong>, and the second category <strong>expression objects</strong>. In function documentation, expression can mean either. You’ll need to figure out which it is by carefully inspecting the context.</p>
<p>There are two other common sources of confusion in base R documentation:</p>
<ul>
<li><p><code>typeof()</code> and <code>str()</code> print “language” for calls, but <code>is.language()</code> returns
<code>TRUE</code> for calls, symbols, and expression objects.</p></li>
<li><p>Symbol and name are used interchangeably (i.e. <code>is.name()</code> is identical to
<code>is.symbol()</code>). I prefer symbol because “name” has other common meanings
(e.g. the name of a variable).</p></li>
</ul>
</div>
<div id="constants" class="section level3">
<h3><span class="header-section-number">17.4.2</span> Constants</h3>
<p></p>
<p>Constants occurred in the leaves of the AST. They are the simplest data structure found in the AST because they are atomic vectors of length 1. Constants are “self-quoting” in the sense that the expression used to represent a constant is the constant itself:</p>
<div class="sourceCode" id="cb673"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb673-1" data-line-number="1"><span class="kw">identical</span>(<span class="kw">expr</span>(<span class="ot">TRUE</span>), <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb673-2" data-line-number="2"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb673-3" data-line-number="3"><span class="kw">identical</span>(<span class="kw">expr</span>(<span class="dv">1</span>), <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb673-4" data-line-number="4"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb673-5" data-line-number="5"><span class="kw">identical</span>(<span class="kw">expr</span>(2L), 2L)</a>
<a class="sourceLine" id="cb673-6" data-line-number="6"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb673-7" data-line-number="7"><span class="kw">identical</span>(<span class="kw">expr</span>(<span class="st">&quot;x&quot;</span>), <span class="st">&quot;x&quot;</span>)</a>
<a class="sourceLine" id="cb673-8" data-line-number="8"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
<p>See Section (scalars) for the conventions for defining these constants.</p>
</div>
<div id="symbols" class="section level3">
<h3><span class="header-section-number">17.4.3</span> Symbols</h3>
<p></p>
<p>Symbols represent variable names. They are basically a string stored in a special way. You can convert back and forth between symbols and the strings that represent them with <code>rlang::sym()</code> and <code>rlang::as_string()</code>:</p>
<div class="sourceCode" id="cb674"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb674-1" data-line-number="1"><span class="st">&quot;x&quot;</span></a>
<a class="sourceLine" id="cb674-2" data-line-number="2"><span class="co">#&gt; [1] &quot;x&quot;</span></a>
<a class="sourceLine" id="cb674-3" data-line-number="3"><span class="kw">sym</span>(<span class="st">&quot;x&quot;</span>)</a>
<a class="sourceLine" id="cb674-4" data-line-number="4"><span class="co">#&gt; x</span></a>
<a class="sourceLine" id="cb674-5" data-line-number="5"><span class="kw">as_string</span>(<span class="kw">sym</span>(<span class="st">&quot;x&quot;</span>))</a>
<a class="sourceLine" id="cb674-6" data-line-number="6"><span class="co">#&gt; [1] &quot;x&quot;</span></a></code></pre></div>
<p>Symbols are scalars: if you want multiple symbols, you’ll need to put them in a list. This is what <code>syms()</code> does:</p>
<div class="sourceCode" id="cb675"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb675-1" data-line-number="1"><span class="kw">syms</span>(<span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;bcd&quot;</span>))</a>
<a class="sourceLine" id="cb675-2" data-line-number="2"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb675-3" data-line-number="3"><span class="co">#&gt; a</span></a>
<a class="sourceLine" id="cb675-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb675-5" data-line-number="5"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb675-6" data-line-number="6"><span class="co">#&gt; bcd</span></a></code></pre></div>
<p>The big difference between strings and symbols is what happens when you evaluate them: evaluating a string returns the string; evaluating a symbol returns the value associated with the symbol in the current environment.</p>
<p>
</p>
<p>There’s one special symbol that needs a little extra discussion: the empty symbol, which is used to represent missing arguments (not missing values!). You can make it with <code>missing_arg()</code> (or <code>expr()</code>):</p>
<div class="sourceCode" id="cb676"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb676-1" data-line-number="1"><span class="kw">missing_arg</span>()</a>
<a class="sourceLine" id="cb676-2" data-line-number="2"><span class="kw">typeof</span>(<span class="kw">missing_arg</span>())</a>
<a class="sourceLine" id="cb676-3" data-line-number="3"><span class="co">#&gt; [1] &quot;symbol&quot;</span></a>
<a class="sourceLine" id="cb676-4" data-line-number="4"><span class="kw">as_string</span>(<span class="kw">missing_arg</span>())</a>
<a class="sourceLine" id="cb676-5" data-line-number="5"><span class="co">#&gt; [1] &quot;&quot;</span></a></code></pre></div>
<p>And see if you have a missing symbol with <code>rlang::is_missing()</code>:</p>
<div class="sourceCode" id="cb677"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb677-1" data-line-number="1"><span class="kw">is_missing</span>(<span class="kw">missing_arg</span>())</a>
<a class="sourceLine" id="cb677-2" data-line-number="2"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
<p>This symbol has a peculiar property: if you bind it to a variable, then access that variable, you will get an error:</p>
<div class="sourceCode" id="cb678"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb678-1" data-line-number="1">m1 &lt;-<span class="st"> </span><span class="kw">missing_arg</span>()</a>
<a class="sourceLine" id="cb678-2" data-line-number="2">m1</a>
<a class="sourceLine" id="cb678-3" data-line-number="3"><span class="co">#&gt; Error in eval(expr, envir, enclos):</span></a>
<a class="sourceLine" id="cb678-4" data-line-number="4"><span class="co">#&gt;   argument &quot;m1&quot; is missing, with no default</span></a></code></pre></div>
<p>But you won’t get an error if it’s stored inside another data structure!</p>
<div class="sourceCode" id="cb679"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb679-1" data-line-number="1">m2 &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">missing_arg</span>())</a>
<a class="sourceLine" id="cb679-2" data-line-number="2">m2[[<span class="dv">1</span>]]</a></code></pre></div>
<p>This is the magic that makes missing arguments work in functions. If you do need to work with a missing argument stored in a variable, you can use <code>rlang::maybe_missing()</code>:</p>
<div class="sourceCode" id="cb680"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb680-1" data-line-number="1"><span class="kw">maybe_missing</span>(m1)</a></code></pre></div>
<p>That prevents the error from occurring and instead returns another empty symbol.</p>
<p>You only need to care about the missing symbol if you’re programmatically creating functions with missing arguments; we’ll come back to that in the next chapter.</p>
</div>
<div id="calls" class="section level3">
<h3><span class="header-section-number">17.4.4</span> Calls</h3>
<p></p>
<p>Calls define the tree in AST. A call behaves similarly to a list:</p>
<ul>
<li>It has a <code>length()</code>.</li>
<li>You can extract elements with <code>[[</code>, <code>[</code>, and <code>$</code>.</li>
<li>Calls can contain other calls.</li>
</ul>
<p>The main difference is that the first element of a call is special: it’s the function that will get called. Let’s explore these ideas with a simple example:</p>
<div class="sourceCode" id="cb681"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb681-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">expr</span>(<span class="kw">read.table</span>(<span class="st">&quot;important.csv&quot;</span>, <span class="dt">row =</span> <span class="ot">FALSE</span>))</a>
<a class="sourceLine" id="cb681-2" data-line-number="2">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="op">!!</span>x)</a>
<a class="sourceLine" id="cb681-3" data-line-number="3"><span class="co">#&gt; █─read.table </span></a>
<a class="sourceLine" id="cb681-4" data-line-number="4"><span class="co">#&gt; ├─&quot;important.csv&quot; </span></a>
<a class="sourceLine" id="cb681-5" data-line-number="5"><span class="co">#&gt; └─row = FALSE</span></a></code></pre></div>
<p>The length of a call minus one gives the number of arguments:</p>
<div class="sourceCode" id="cb682"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb682-1" data-line-number="1"><span class="kw">length</span>(x) <span class="op">-</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb682-2" data-line-number="2"><span class="co">#&gt; [1] 2</span></a></code></pre></div>
<p>The names of a call are empty, except for named arguments:</p>
<div class="sourceCode" id="cb683"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb683-1" data-line-number="1"><span class="kw">names</span>(x)</a>
<a class="sourceLine" id="cb683-2" data-line-number="2"><span class="co">#&gt; [1] &quot;&quot;    &quot;&quot;    &quot;row&quot;</span></a></code></pre></div>
<p>You can extract the leaves of the call by position and by name using <code>[[</code> and <code>$</code> in the usual way:</p>
<div class="sourceCode" id="cb684"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb684-1" data-line-number="1">x[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb684-2" data-line-number="2"><span class="co">#&gt; read.table</span></a>
<a class="sourceLine" id="cb684-3" data-line-number="3">x[[<span class="dv">2</span>]]</a>
<a class="sourceLine" id="cb684-4" data-line-number="4"><span class="co">#&gt; [1] &quot;important.csv&quot;</span></a>
<a class="sourceLine" id="cb684-5" data-line-number="5"></a>
<a class="sourceLine" id="cb684-6" data-line-number="6">x<span class="op">$</span>row</a>
<a class="sourceLine" id="cb684-7" data-line-number="7"><span class="co">#&gt; [1] FALSE</span></a></code></pre></div>
<p>Extracting specific arguments from calls is challenging because of R’s flexible rules for argument matching: it could potentially be in any location, with the full name, with an abbreviated name, or with no name. To work around this problem, you can use <code>rlang::call_standardise()</code> which standardises all arguments to use the full name: </p>
<div class="sourceCode" id="cb685"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb685-1" data-line-number="1">rlang<span class="op">::</span><span class="kw">call_standardise</span>(x)</a>
<a class="sourceLine" id="cb685-2" data-line-number="2"><span class="co">#&gt; read.table(file = &quot;important.csv&quot;, row.names = FALSE)</span></a></code></pre></div>
<p>(Note that if the function uses <code>...</code> it’s not possible to standardise all arguments.)</p>
<p>You can use <code>[</code> to extract multiple components, but if you drop the first element, you’re going to end up with a weird call:</p>
<div class="sourceCode" id="cb686"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb686-1" data-line-number="1">x[<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>]</a>
<a class="sourceLine" id="cb686-2" data-line-number="2"><span class="co">#&gt; &quot;important.csv&quot;(row = FALSE)</span></a></code></pre></div>
<p>If you do want to extract multiple elements in this way, it’s good practice to coerce the results to a list:</p>
<div class="sourceCode" id="cb687"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb687-1" data-line-number="1"><span class="kw">as.list</span>(x[<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>])</a>
<a class="sourceLine" id="cb687-2" data-line-number="2"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb687-3" data-line-number="3"><span class="co">#&gt; [1] &quot;important.csv&quot;</span></a>
<a class="sourceLine" id="cb687-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb687-5" data-line-number="5"><span class="co">#&gt; $row</span></a>
<a class="sourceLine" id="cb687-6" data-line-number="6"><span class="co">#&gt; [1] FALSE</span></a></code></pre></div>
<p>Calls can be modified in the same way as lists:</p>
<div class="sourceCode" id="cb688"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb688-1" data-line-number="1">x<span class="op">$</span>header &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb688-2" data-line-number="2">x</a>
<a class="sourceLine" id="cb688-3" data-line-number="3"><span class="co">#&gt; read.table(&quot;important.csv&quot;, row = FALSE, header = TRUE)</span></a></code></pre></div>
<p>You can construct a call from its children by using <code>rlang::call2()</code>. The first argument should be the function to be called (supplied either as a string or a symbol), and the subsequent arguments are the call to that function:</p>
<div class="sourceCode" id="cb689"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb689-1" data-line-number="1"><span class="kw">call2</span>(<span class="st">&quot;mean&quot;</span>, <span class="dt">x =</span> <span class="kw">expr</span>(x), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb689-2" data-line-number="2"><span class="co">#&gt; mean(x = x, na.rm = TRUE)</span></a>
<a class="sourceLine" id="cb689-3" data-line-number="3"><span class="kw">call2</span>(<span class="kw">expr</span>(mean), <span class="dt">x =</span> <span class="kw">expr</span>(x), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb689-4" data-line-number="4"><span class="co">#&gt; mean(x = x, na.rm = TRUE)</span></a></code></pre></div>
</div>
<div id="pairlists" class="section level3">
<h3><span class="header-section-number">17.4.5</span> Pairlists</h3>
<p></p>
<p>There is one data structure we need to discuss for completeness: the pairlist. Pairlists are a remnant of R’s past and have been replaced by lists almost everywhere. The only place you are likely to see pairlists in R<a href="#fn53" class="footnote-ref" id="fnref53"><sup>53</sup></a> is when working with function arguments:</p>
<div class="sourceCode" id="cb690"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb690-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">x =</span> <span class="dv">10</span>) x <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb690-2" data-line-number="2"><span class="kw">typeof</span>(<span class="kw">formals</span>(f))</a>
<a class="sourceLine" id="cb690-3" data-line-number="3"><span class="co">#&gt; [1] &quot;pairlist&quot;</span></a></code></pre></div>
<p>Fortunately, whenever you encounter a pairlist, you can treat it just like a regular list:</p>
<div class="sourceCode" id="cb691"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb691-1" data-line-number="1">pl &lt;-<span class="st"> </span><span class="kw">pairlist</span>(<span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">y =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb691-2" data-line-number="2"><span class="kw">length</span>(pl)</a>
<a class="sourceLine" id="cb691-3" data-line-number="3"><span class="co">#&gt; [1] 2</span></a>
<a class="sourceLine" id="cb691-4" data-line-number="4">pl<span class="op">$</span>x</a>
<a class="sourceLine" id="cb691-5" data-line-number="5"><span class="co">#&gt; [1] 1</span></a></code></pre></div>
<p>However, behind the scenes pairlists are implemented using a different data structure, a linked list instead of a vector. That means that subsetting is slower with pairlists, and gets slower the further along the pairlist you index because it’s <span class="math inline">\(O(n)\)</span> rather than <span class="math inline">\(O(1)\)</span>. This has little impact in practice.</p>
</div>
<div id="expression-objects" class="section level3">
<h3><span class="header-section-number">17.4.6</span> Expression objects</h3>
<p>  </p>
<p>Finally, we need to briefly discuss the expression object. Expression objects are produced by only two base functions: <code>expression()</code> and <code>parse()</code>:</p>
<div class="sourceCode" id="cb692"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb692-1" data-line-number="1">exp1 &lt;-<span class="st"> </span><span class="kw">parse</span>(<span class="dt">text =</span> <span class="kw">c</span>(<span class="st">&quot;</span></a>
<a class="sourceLine" id="cb692-2" data-line-number="2"><span class="st">x &lt;- 4</span></a>
<a class="sourceLine" id="cb692-3" data-line-number="3"><span class="st">x</span></a>
<a class="sourceLine" id="cb692-4" data-line-number="4"><span class="st">&quot;</span>))</a>
<a class="sourceLine" id="cb692-5" data-line-number="5">exp2 &lt;-<span class="st"> </span><span class="kw">expression</span>(x &lt;-<span class="st"> </span><span class="dv">4</span>, x)</a>
<a class="sourceLine" id="cb692-6" data-line-number="6"></a>
<a class="sourceLine" id="cb692-7" data-line-number="7"><span class="kw">typeof</span>(exp1)</a>
<a class="sourceLine" id="cb692-8" data-line-number="8"><span class="co">#&gt; [1] &quot;expression&quot;</span></a>
<a class="sourceLine" id="cb692-9" data-line-number="9"><span class="kw">typeof</span>(exp2)</a>
<a class="sourceLine" id="cb692-10" data-line-number="10"><span class="co">#&gt; [1] &quot;expression&quot;</span></a>
<a class="sourceLine" id="cb692-11" data-line-number="11"></a>
<a class="sourceLine" id="cb692-12" data-line-number="12">exp1</a>
<a class="sourceLine" id="cb692-13" data-line-number="13"><span class="co">#&gt; expression(x &lt;- 4, x)</span></a>
<a class="sourceLine" id="cb692-14" data-line-number="14">exp2</a>
<a class="sourceLine" id="cb692-15" data-line-number="15"><span class="co">#&gt; expression(x &lt;- 4, x)</span></a></code></pre></div>
<p>Like calls and pairlists, expression objects behave like a list:</p>
<div class="sourceCode" id="cb693"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb693-1" data-line-number="1"><span class="kw">length</span>(exp1)</a>
<a class="sourceLine" id="cb693-2" data-line-number="2"><span class="co">#&gt; [1] 2</span></a>
<a class="sourceLine" id="cb693-3" data-line-number="3">exp1[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb693-4" data-line-number="4"><span class="co">#&gt; x &lt;- 4</span></a></code></pre></div>
<p>Conceptually, an expression object is just a list of expressions. The only difference is that calling <code>eval()</code> on an expression evaluates each individual expression. We don’t believe this advantage merits introducing a new data structure, so instead of expression objects we always use regular lists of expressions.</p>
</div>
<div id="exercises-52" class="section level3">
<h3><span class="header-section-number">17.4.7</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Which two of the six types of atomic vector can’t appear in an expression?
Why? Why can’t you create an expression that contains an atomic vector of
length greater than one?</p></li>
<li><p>How is <code>rlang::maybe_missing()</code> implemented? Why does it work?</p></li>
<li><p>Describe the differences between the following calls?</p>
<div class="sourceCode" id="cb694"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb694-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></a>
<a class="sourceLine" id="cb694-2" data-line-number="2"></a>
<a class="sourceLine" id="cb694-3" data-line-number="3"><span class="kw">call2</span>(median, x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb694-4" data-line-number="4"><span class="kw">call2</span>(<span class="kw">expr</span>(median), x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb694-5" data-line-number="5"><span class="kw">call2</span>(median, <span class="kw">expr</span>(x), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb694-6" data-line-number="6"><span class="kw">call2</span>(<span class="kw">expr</span>(median), <span class="kw">expr</span>(x), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div></li>
<li><p><code>rlang::call_standardise()</code> doesn’t work so well for the following calls.
Why? What makes <code>mean()</code> special?</p>
<div class="sourceCode" id="cb695"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb695-1" data-line-number="1"><span class="kw">call_standardise</span>(<span class="kw">quote</span>(<span class="kw">mean</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)))</a>
<a class="sourceLine" id="cb695-2" data-line-number="2"><span class="co">#&gt; mean(x = 1:10, na.rm = TRUE)</span></a>
<a class="sourceLine" id="cb695-3" data-line-number="3"><span class="kw">call_standardise</span>(<span class="kw">quote</span>(<span class="kw">mean</span>(<span class="dt">n =</span> T, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)))</a>
<a class="sourceLine" id="cb695-4" data-line-number="4"><span class="co">#&gt; mean(x = 1:10, n = T)</span></a>
<a class="sourceLine" id="cb695-5" data-line-number="5"><span class="kw">call_standardise</span>(<span class="kw">quote</span>(<span class="kw">mean</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, , <span class="ot">TRUE</span>)))</a>
<a class="sourceLine" id="cb695-6" data-line-number="6"><span class="co">#&gt; mean(x = 1:10, , TRUE)</span></a></code></pre></div></li>
<li><p>Why does this code not make sense?</p>
<div class="sourceCode" id="cb696"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb696-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">expr</span>(<span class="kw">foo</span>(<span class="dt">x =</span> <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb696-2" data-line-number="2"><span class="kw">names</span>(x) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;&quot;</span>)</a></code></pre></div></li>
<li><p>Construct the expression <code>if(x &gt; 1) &quot;a&quot; else &quot;b&quot;</code> using multiple calls to
<code>call2()</code>. How does the code structure reflect the structure of the AST?</p></li>
</ol>
</div>
</div>
<div id="parsing-and-deparsing" class="section level2">
<h2><span class="header-section-number">17.5</span> Parsing and deparsing</h2>
<p>Most of the time you type code into the console, and R takes care of turning the characters you’ve typed into an AST. But occasionally you have code stored in a string, and you want to parse it yourself. You can do so using <code>rlang::parse_expr()</code>:</p>
<div class="sourceCode" id="cb697"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb697-1" data-line-number="1">x1 &lt;-<span class="st"> &quot;y &lt;- x + 10&quot;</span></a>
<a class="sourceLine" id="cb697-2" data-line-number="2">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="op">!!</span>x1)</a>
<a class="sourceLine" id="cb697-3" data-line-number="3"><span class="co">#&gt; &quot;y &lt;- x + 10&quot;</span></a>
<a class="sourceLine" id="cb697-4" data-line-number="4"></a>
<a class="sourceLine" id="cb697-5" data-line-number="5">x2 &lt;-<span class="st"> </span>rlang<span class="op">::</span><span class="kw">parse_expr</span>(x1)</a>
<a class="sourceLine" id="cb697-6" data-line-number="6">x2</a>
<a class="sourceLine" id="cb697-7" data-line-number="7"><span class="co">#&gt; y &lt;- x + 10</span></a>
<a class="sourceLine" id="cb697-8" data-line-number="8">lobstr<span class="op">::</span><span class="kw">ast</span>(<span class="op">!!</span>x2)</a>
<a class="sourceLine" id="cb697-9" data-line-number="9"><span class="co">#&gt; █─`&lt;-` </span></a>
<a class="sourceLine" id="cb697-10" data-line-number="10"><span class="co">#&gt; ├─y </span></a>
<a class="sourceLine" id="cb697-11" data-line-number="11"><span class="co">#&gt; └─█─`+` </span></a>
<a class="sourceLine" id="cb697-12" data-line-number="12"><span class="co">#&gt;   ├─x </span></a>
<a class="sourceLine" id="cb697-13" data-line-number="13"><span class="co">#&gt;   └─10</span></a></code></pre></div>
<p>If you have multiple expressions in a string, you’ll need to use <code>rlang::parse_exprs()</code>. It returns a list of expressions:</p>
<div class="sourceCode" id="cb698"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb698-1" data-line-number="1">x3 &lt;-<span class="st"> &quot;a &lt;- 1; a + 1&quot;</span></a>
<a class="sourceLine" id="cb698-2" data-line-number="2">rlang<span class="op">::</span><span class="kw">parse_exprs</span>(x3)</a>
<a class="sourceLine" id="cb698-3" data-line-number="3"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb698-4" data-line-number="4"><span class="co">#&gt; a &lt;- 1</span></a>
<a class="sourceLine" id="cb698-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb698-6" data-line-number="6"><span class="co">#&gt; [[2]]</span></a>
<a class="sourceLine" id="cb698-7" data-line-number="7"><span class="co">#&gt; a + 1</span></a></code></pre></div>
<p>If you find yourself working with strings containing code very frequently, you should reconsider your process. Read the Chapter <a href="quasiquotation.html#quasiquotation">18</a> and consider if you can instead more safely generate expressions using quasiquotation.</p>
<div class="base">
<p>The base equivalent to <code>parse_exprs()</code> is <code>parse()</code>. It is a little harder to use because it’s specialised for parsing R code stored in files. That means you need supply your string to the <code>text</code> argument, and you get back an expression object:</p>
<div class="sourceCode" id="cb699"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb699-1" data-line-number="1"><span class="kw">parse</span>(<span class="dt">text =</span> x1)[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb699-2" data-line-number="2"><span class="co">#&gt; y &lt;- x + 10</span></a></code></pre></div>
</div>
<p>The opposite of parsing is <strong>deparsing</strong>: you have an AST and you want a string that would generate it when parsed:</p>
<div class="sourceCode" id="cb700"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb700-1" data-line-number="1">z &lt;-<span class="st"> </span><span class="kw">expr</span>(y &lt;-<span class="st"> </span>x <span class="op">+</span><span class="st"> </span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb700-2" data-line-number="2"><span class="kw">expr_text</span>(z)</a>
<a class="sourceLine" id="cb700-3" data-line-number="3"><span class="co">#&gt; [1] &quot;y &lt;- x + 10&quot;</span></a></code></pre></div>
<p>Parsing and deparsing are not perfectly symmetric because parsing throws away all information not directly related to the AST. This includes backticks around ordinary names, comments, and whitespace:</p>
<div class="sourceCode" id="cb701"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb701-1" data-line-number="1"><span class="kw">cat</span>(<span class="kw">expr_text</span>(<span class="kw">expr</span>({</a>
<a class="sourceLine" id="cb701-2" data-line-number="2">  <span class="co"># This is a comment</span></a>
<a class="sourceLine" id="cb701-3" data-line-number="3">  x &lt;-<span class="st">             `</span><span class="dt">x</span><span class="st">`</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb701-4" data-line-number="4">})))</a>
<a class="sourceLine" id="cb701-5" data-line-number="5"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb701-6" data-line-number="6"><span class="co">#&gt;     x &lt;- x + 1</span></a>
<a class="sourceLine" id="cb701-7" data-line-number="7"><span class="co">#&gt; }</span></a></code></pre></div>
<p>There are a few other cases where parsing and deparsing is not symmetric. We’ll encounter one in the next chapter:</p>
<div class="sourceCode" id="cb702"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb702-1" data-line-number="1"><span class="kw">expr_text</span>(<span class="kw">parse_expr</span>(<span class="st">&quot;!!x&quot;</span>))</a>
<a class="sourceLine" id="cb702-2" data-line-number="2"><span class="co">#&gt; [1] &quot;!!x&quot;</span></a></code></pre></div>
<p>Deparsing is often used to provide default names for data structures (like data frames), and default labels for messages or other output. rlang provides two helpers for those situations:</p>
<div class="sourceCode" id="cb703"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb703-1" data-line-number="1">z &lt;-<span class="st"> </span><span class="kw">expr</span>(<span class="kw">f</span>(x, y, z))</a>
<a class="sourceLine" id="cb703-2" data-line-number="2"></a>
<a class="sourceLine" id="cb703-3" data-line-number="3"><span class="kw">expr_name</span>(z)</a>
<a class="sourceLine" id="cb703-4" data-line-number="4"><span class="co">#&gt; [1] &quot;f(x, y, z)&quot;</span></a>
<a class="sourceLine" id="cb703-5" data-line-number="5"><span class="kw">expr_label</span>(z)</a>
<a class="sourceLine" id="cb703-6" data-line-number="6"><span class="co">#&gt; [1] &quot;`f(x, y, z)`&quot;</span></a></code></pre></div>
<p>Be careful when using the base R equivalent, <code>deparse()</code>: it returns a character vector with one element for each line. Whenever you use it, remember that the length of the output might be greater than one, and plan accordingly.</p>
<div id="exercises-53" class="section level3">
<h3><span class="header-section-number">17.5.1</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>What happens if you attempt to parse an invalid expression? e.g. <code>&quot;a +&quot;</code>
or <code>&quot;f())&quot;</code>.</p></li>
<li><p><code>deparse()</code> produces vectors when the input is long. For example, the
following call produces a vector of length two:</p>
<div class="sourceCode" id="cb704"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb704-1" data-line-number="1">expr &lt;-<span class="st"> </span><span class="kw">expr</span>(<span class="kw">g</span>(a <span class="op">+</span><span class="st"> </span>b <span class="op">+</span><span class="st"> </span>c <span class="op">+</span><span class="st"> </span>d <span class="op">+</span><span class="st"> </span>e <span class="op">+</span><span class="st"> </span>f <span class="op">+</span><span class="st"> </span>g <span class="op">+</span><span class="st"> </span>h <span class="op">+</span><span class="st"> </span>i <span class="op">+</span><span class="st"> </span>j <span class="op">+</span><span class="st"> </span>k <span class="op">+</span><span class="st"> </span>l <span class="op">+</span><span class="st"> </span>m <span class="op">+</span></a>
<a class="sourceLine" id="cb704-2" data-line-number="2"><span class="st">  </span>n <span class="op">+</span><span class="st"> </span>o <span class="op">+</span><span class="st"> </span>p <span class="op">+</span><span class="st"> </span>q <span class="op">+</span><span class="st"> </span>r <span class="op">+</span><span class="st"> </span>s <span class="op">+</span><span class="st"> </span>t <span class="op">+</span><span class="st"> </span>u <span class="op">+</span><span class="st"> </span>v <span class="op">+</span><span class="st"> </span>w <span class="op">+</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>y <span class="op">+</span><span class="st"> </span>z))</a>
<a class="sourceLine" id="cb704-3" data-line-number="3"></a>
<a class="sourceLine" id="cb704-4" data-line-number="4"><span class="kw">deparse</span>(expr)</a></code></pre></div>
<p>What do <code>expr_text()</code>, <code>expr_name()</code>, and <code>expr_label()</code> do with this input?</p></li>
<li><p>Why does <code>as.Date.default()</code> use <code>substitute()</code> and <code>deparse()</code>?
Why does <code>pairwise.t.test()</code> use them? Read the source code.</p></li>
<li><p><code>pairwise.t.test()</code> assumes that <code>deparse()</code> always returns a length one
character vector. Can you construct an input that violates this expectation?
What happens?</p></li>
</ol>
</div>
</div>
<div id="ast-funs" class="section level2">
<h2><span class="header-section-number">17.6</span> Case study: Walking the AST with recursive functions</h2>
<p></p>
<p>To conclude the chapter I’m going to pull together everything that you’ve learned about ASTs and use that knowledge to solve more complicated problems. The inspiration comes from the base codetools package, which provides two interesting functions:</p>
<ul>
<li><p><code>findGlobals()</code> locates all global variables used by a function. This
can be useful if you want to check that your function doesn’t inadvertently
rely on variables defined in their parent environment.</p></li>
<li><p><code>checkUsage()</code> checks for a range of common problems including
unused local variables, unused parameters, and the use of partial
argument matching.</p></li>
</ul>
<p>Getting all of the details of these functions correct is fiddly, so we won’t explore their full expression. Instead we’ll focus on the big underlying idea: recursion on the AST. Recursive functions are a natural fit to tree-like data structures because a recursive function is made up of two parts that correspond to the two parts of the tree:</p>
<ul>
<li><p>The <strong>recursive case</strong> handles the nodes in the tree. Typically, you’ll
do something to each child of node, usually calling the recursive function
again, and then combine the results back together again. For expressions,
you’ll need to handle calls and pairlists (function arguments).</p></li>
<li><p>The <strong>base case</strong> handles the leaves of the tree. The base cases ensure
that the function eventually terminates, by solving the simplest cases
directly. For expressions, you need to handle symbols and constants in the
base case.</p></li>
</ul>
<p>To make this pattern easier to see, we’ll need two helper functions. First we define <code>expr_type()</code> which will return “constant” for constant, “symbol” for symbols, “call”, for calls, “pairlist” for pairlists, and the “type” of anything else:</p>
<div class="sourceCode" id="cb705"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb705-1" data-line-number="1">expr_type &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb705-2" data-line-number="2">  <span class="cf">if</span> (rlang<span class="op">::</span><span class="kw">is_syntactic_literal</span>(x)) {</a>
<a class="sourceLine" id="cb705-3" data-line-number="3">    <span class="st">&quot;constant&quot;</span></a>
<a class="sourceLine" id="cb705-4" data-line-number="4">  } <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">is.symbol</span>(x)) {</a>
<a class="sourceLine" id="cb705-5" data-line-number="5">    <span class="st">&quot;symbol&quot;</span></a>
<a class="sourceLine" id="cb705-6" data-line-number="6">  } <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">is.call</span>(x)) {</a>
<a class="sourceLine" id="cb705-7" data-line-number="7">    <span class="st">&quot;call&quot;</span></a>
<a class="sourceLine" id="cb705-8" data-line-number="8">  } <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">is.pairlist</span>(x)) {</a>
<a class="sourceLine" id="cb705-9" data-line-number="9">    <span class="st">&quot;pairlist&quot;</span></a>
<a class="sourceLine" id="cb705-10" data-line-number="10">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb705-11" data-line-number="11">    <span class="kw">typeof</span>(x)</a>
<a class="sourceLine" id="cb705-12" data-line-number="12">  }</a>
<a class="sourceLine" id="cb705-13" data-line-number="13">}</a>
<a class="sourceLine" id="cb705-14" data-line-number="14"></a>
<a class="sourceLine" id="cb705-15" data-line-number="15"><span class="kw">expr_type</span>(<span class="kw">expr</span>(<span class="st">&quot;a&quot;</span>))</a>
<a class="sourceLine" id="cb705-16" data-line-number="16"><span class="co">#&gt; [1] &quot;constant&quot;</span></a>
<a class="sourceLine" id="cb705-17" data-line-number="17"><span class="kw">expr_type</span>(<span class="kw">expr</span>(<span class="kw">f</span>(<span class="dv">1</span>, <span class="dv">2</span>)))</a>
<a class="sourceLine" id="cb705-18" data-line-number="18"><span class="co">#&gt; [1] &quot;call&quot;</span></a></code></pre></div>
<p>We’ll couple this with a wrapper around the switch function:</p>
<div class="sourceCode" id="cb706"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb706-1" data-line-number="1">switch_expr &lt;-<span class="st"> </span><span class="cf">function</span>(x, ...) {</a>
<a class="sourceLine" id="cb706-2" data-line-number="2">  <span class="cf">switch</span>(<span class="kw">expr_type</span>(x), </a>
<a class="sourceLine" id="cb706-3" data-line-number="3">    ..., </a>
<a class="sourceLine" id="cb706-4" data-line-number="4">    <span class="kw">stop</span>(<span class="st">&quot;Don&#39;t know how to handle type &quot;</span>, <span class="kw">typeof</span>(x), <span class="dt">call. =</span> <span class="ot">FALSE</span>)  </a>
<a class="sourceLine" id="cb706-5" data-line-number="5">  )</a>
<a class="sourceLine" id="cb706-6" data-line-number="6">}</a></code></pre></div>
<p>With these two functions in hand, the basic template for any function that walks the AST is as follows:</p>
<div class="sourceCode" id="cb707"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb707-1" data-line-number="1">recurse_call &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb707-2" data-line-number="2">  <span class="kw">switch_expr</span>(x, </a>
<a class="sourceLine" id="cb707-3" data-line-number="3">    <span class="co"># Base cases</span></a>
<a class="sourceLine" id="cb707-4" data-line-number="4">    <span class="dt">symbol =</span> ,</a>
<a class="sourceLine" id="cb707-5" data-line-number="5">    <span class="dt">constant =</span> ,</a>
<a class="sourceLine" id="cb707-6" data-line-number="6">    </a>
<a class="sourceLine" id="cb707-7" data-line-number="7">    <span class="co"># Recursive cases</span></a>
<a class="sourceLine" id="cb707-8" data-line-number="8">    <span class="dt">call =</span> ,</a>
<a class="sourceLine" id="cb707-9" data-line-number="9">    <span class="dt">pairlist =</span> </a>
<a class="sourceLine" id="cb707-10" data-line-number="10">  )</a>
<a class="sourceLine" id="cb707-11" data-line-number="11">}</a></code></pre></div>
<p>Typically, solving the base case is easy, so we’ll do that first, then check the results. The recursive cases are a little more tricky. Typically you’ll think about the structure of final output and then find the correct purrr function to produce it. To that end, make sure you’re familiar with <a href="functionals.html#functionals">Functionals</a> before continuing.</p>
<div id="finding-f-and-t" class="section level3">
<h3><span class="header-section-number">17.6.1</span> Finding F and T</h3>
<p>We’ll start simple with a function that determines whether a function uses the logical abbreviations <code>T</code> and <code>F</code>: it will return <code>TRUE</code> if it finds a logical abbreviation, and <code>FALSE</code> otherwise. Using <code>T</code> and <code>F</code> is generally considered to be poor coding practice, and is something that <code>R CMD check</code> will warn about.</p>
<p>Let’s first compare the AST for <code>T</code> vs. <code>TRUE</code>:</p>
<div class="sourceCode" id="cb708"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb708-1" data-line-number="1"><span class="kw">ast</span>(<span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb708-2" data-line-number="2"><span class="co">#&gt; TRUE</span></a>
<a class="sourceLine" id="cb708-3" data-line-number="3"><span class="kw">ast</span>(T)</a>
<a class="sourceLine" id="cb708-4" data-line-number="4"><span class="co">#&gt; T</span></a></code></pre></div>
<p><code>TRUE</code> is parsed as a logical vector of length one, while <code>T</code> is parsed as a name. This tells us how to write our base cases for the recursive function: a constant is never a logical abbreviation, and a symbol is an abbreviation if it’s “F” or “T”:</p>
<div class="sourceCode" id="cb709"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb709-1" data-line-number="1">logical_abbr_rec &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb709-2" data-line-number="2">  <span class="kw">switch_expr</span>(x, </a>
<a class="sourceLine" id="cb709-3" data-line-number="3">    <span class="dt">constant =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb709-4" data-line-number="4">    <span class="dt">symbol =</span> <span class="kw">as_string</span>(x) <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;F&quot;</span>, <span class="st">&quot;T&quot;</span>)</a>
<a class="sourceLine" id="cb709-5" data-line-number="5">  )</a>
<a class="sourceLine" id="cb709-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb709-7" data-line-number="7"></a>
<a class="sourceLine" id="cb709-8" data-line-number="8"><span class="kw">logical_abbr_rec</span>(<span class="kw">expr</span>(<span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb709-9" data-line-number="9"><span class="co">#&gt; [1] FALSE</span></a>
<a class="sourceLine" id="cb709-10" data-line-number="10"><span class="kw">logical_abbr_rec</span>(<span class="kw">expr</span>(T))</a>
<a class="sourceLine" id="cb709-11" data-line-number="11"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
<p>I’ve written <code>logical_abbr_rec()</code> function assuming that the input will be an expression as this will make the recursive operation simpler. However, when writing a recursive function it’s common to write a wrapper that provides defaults or makes the function a little easier to use. Here we’ll typically make a wrapper that quotes its input (we’ll learn more about that in the next chapter), so we don’t need to use <code>expr()</code> every time.</p>
<div class="sourceCode" id="cb710"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb710-1" data-line-number="1">logical_abbr &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb710-2" data-line-number="2">  <span class="kw">logical_abbr_rec</span>(<span class="kw">enexpr</span>(x))</a>
<a class="sourceLine" id="cb710-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb710-4" data-line-number="4"></a>
<a class="sourceLine" id="cb710-5" data-line-number="5"><span class="kw">logical_abbr</span>(T)</a>
<a class="sourceLine" id="cb710-6" data-line-number="6"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb710-7" data-line-number="7"><span class="kw">logical_abbr</span>(<span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb710-8" data-line-number="8"><span class="co">#&gt; [1] FALSE</span></a></code></pre></div>
<p>Next we need to implement the recursive cases. Here it’s simple because we want to do the same thing for calls and for pairlists: recursively apply the function to each subcomponent, and return <code>TRUE</code> if any subcomponent contains a logical abbreviation. This is made easy by <code>purrr::some()</code>, which iterates over a list and returns <code>TRUE</code> if the predicate function is true for any element.</p>
<div class="sourceCode" id="cb711"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb711-1" data-line-number="1">logical_abbr_rec &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb711-2" data-line-number="2">  <span class="kw">switch_expr</span>(x,</a>
<a class="sourceLine" id="cb711-3" data-line-number="3">    <span class="co"># Base cases</span></a>
<a class="sourceLine" id="cb711-4" data-line-number="4">    <span class="dt">constant =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb711-5" data-line-number="5">    <span class="dt">symbol =</span> <span class="kw">as_string</span>(x) <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;F&quot;</span>, <span class="st">&quot;T&quot;</span>),</a>
<a class="sourceLine" id="cb711-6" data-line-number="6">    </a>
<a class="sourceLine" id="cb711-7" data-line-number="7">    <span class="co"># Recursive cases</span></a>
<a class="sourceLine" id="cb711-8" data-line-number="8">    <span class="dt">call =</span> ,</a>
<a class="sourceLine" id="cb711-9" data-line-number="9">    <span class="dt">pairlist =</span> purrr<span class="op">::</span><span class="kw">some</span>(x, logical_abbr_rec)</a>
<a class="sourceLine" id="cb711-10" data-line-number="10">  )</a>
<a class="sourceLine" id="cb711-11" data-line-number="11">}</a>
<a class="sourceLine" id="cb711-12" data-line-number="12"></a>
<a class="sourceLine" id="cb711-13" data-line-number="13"><span class="kw">logical_abbr</span>(<span class="kw">mean</span>(x, <span class="dt">na.rm =</span> T))</a>
<a class="sourceLine" id="cb711-14" data-line-number="14"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb711-15" data-line-number="15"><span class="kw">logical_abbr</span>(<span class="cf">function</span>(x, <span class="dt">na.rm =</span> T) <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb711-16" data-line-number="16"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
</div>
<div id="finding-all-variables-created-by-assignment" class="section level3">
<h3><span class="header-section-number">17.6.2</span> Finding all variables created by assignment</h3>
<p><code>logical_abbr()</code> is very simple: it only returns a single <code>TRUE</code> or <code>FALSE</code>. The next task, listing all variables created by assignment, is a little more complicated. We’ll start simply, and then make the function progressively more rigorous. </p>
<p>We start by looking at the AST for assignment:</p>
<div class="sourceCode" id="cb712"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb712-1" data-line-number="1"><span class="kw">ast</span>(x &lt;-<span class="st"> </span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb712-2" data-line-number="2"><span class="co">#&gt; █─`&lt;-` </span></a>
<a class="sourceLine" id="cb712-3" data-line-number="3"><span class="co">#&gt; ├─x </span></a>
<a class="sourceLine" id="cb712-4" data-line-number="4"><span class="co">#&gt; └─10</span></a></code></pre></div>
<p>Assignment is a call where the first element is the symbol <code>&lt;-</code>, the second is the name of variable, and the third is the value to be assigned.</p>
<p>Next, we need to decide what data structure we’re going to use for the results. Here I think it will be easiest if we return a character vector. If we return symbols, we’ll need to use a <code>list()</code> and that makes things a little more complicated.</p>
<p>With that in hand we can start by implementing the base cases and providing a helpful wrapper around the recursive function. The base cases here are really simple!</p>
<div class="sourceCode" id="cb713"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb713-1" data-line-number="1">find_assign_rec &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb713-2" data-line-number="2">  <span class="kw">switch_expr</span>(x, </a>
<a class="sourceLine" id="cb713-3" data-line-number="3">    <span class="dt">constant =</span> ,</a>
<a class="sourceLine" id="cb713-4" data-line-number="4">    <span class="dt">symbol =</span> <span class="kw">character</span>()</a>
<a class="sourceLine" id="cb713-5" data-line-number="5">  )  </a>
<a class="sourceLine" id="cb713-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb713-7" data-line-number="7">find_assign &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">find_assign_rec</span>(<span class="kw">enexpr</span>(x))</a>
<a class="sourceLine" id="cb713-8" data-line-number="8"></a>
<a class="sourceLine" id="cb713-9" data-line-number="9"><span class="kw">find_assign</span>(<span class="st">&quot;x&quot;</span>)</a>
<a class="sourceLine" id="cb713-10" data-line-number="10"><span class="co">#&gt; character(0)</span></a>
<a class="sourceLine" id="cb713-11" data-line-number="11"><span class="kw">find_assign</span>(x)</a>
<a class="sourceLine" id="cb713-12" data-line-number="12"><span class="co">#&gt; character(0)</span></a></code></pre></div>
<p>Next we implement the recursive cases. This is made easier by a function that should exist in purrr, but currently doesn’t. <code>flat_map_chr()</code> expects <code>.f</code> to return a character vector of arbitrary length, and flattens all results into a single character vector.</p>
<div class="sourceCode" id="cb714"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb714-1" data-line-number="1">flat_map_chr &lt;-<span class="st"> </span><span class="cf">function</span>(.x, .f, ...) {</a>
<a class="sourceLine" id="cb714-2" data-line-number="2">  purrr<span class="op">::</span><span class="kw">flatten_chr</span>(purrr<span class="op">::</span><span class="kw">map</span>(.x, .f, ...))</a>
<a class="sourceLine" id="cb714-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb714-4" data-line-number="4"></a>
<a class="sourceLine" id="cb714-5" data-line-number="5"><span class="kw">flat_map_chr</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="op">~</span><span class="st"> </span><span class="kw">rep</span>(., <span class="kw">sample</span>(<span class="dv">3</span>, <span class="dv">1</span>)))</a>
<a class="sourceLine" id="cb714-6" data-line-number="6"><span class="co">#&gt; [1] &quot;a&quot; &quot;a&quot; &quot;b&quot; &quot;b&quot; &quot;b&quot; &quot;c&quot; &quot;c&quot; &quot;c&quot;</span></a></code></pre></div>
<p>The recursive case for pairlists is simple: we iterate over every element of the pairlist (i.e. each function argument) and combine the results. The case for calls is a little bit more complex - if this is a call to <code>&lt;-</code> then we should return the second element of the call:</p>
<div class="sourceCode" id="cb715"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb715-1" data-line-number="1">find_assign_rec &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb715-2" data-line-number="2">  <span class="kw">switch_expr</span>(x,</a>
<a class="sourceLine" id="cb715-3" data-line-number="3">    <span class="co"># Base cases</span></a>
<a class="sourceLine" id="cb715-4" data-line-number="4">    <span class="dt">constant =</span> ,</a>
<a class="sourceLine" id="cb715-5" data-line-number="5">    <span class="dt">symbol =</span> <span class="kw">character</span>(),</a>
<a class="sourceLine" id="cb715-6" data-line-number="6">    </a>
<a class="sourceLine" id="cb715-7" data-line-number="7">    <span class="co"># Recursive cases</span></a>
<a class="sourceLine" id="cb715-8" data-line-number="8">    <span class="dt">pairlist =</span> <span class="kw">flat_map_chr</span>(<span class="kw">as.list</span>(x), find_assign_rec),</a>
<a class="sourceLine" id="cb715-9" data-line-number="9">    <span class="dt">call =</span> {</a>
<a class="sourceLine" id="cb715-10" data-line-number="10">      <span class="cf">if</span> (<span class="kw">is_call</span>(x, <span class="st">&quot;&lt;-&quot;</span>)) {</a>
<a class="sourceLine" id="cb715-11" data-line-number="11">        <span class="kw">as_string</span>(x[[<span class="dv">2</span>]])</a>
<a class="sourceLine" id="cb715-12" data-line-number="12">      } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb715-13" data-line-number="13">        <span class="kw">flat_map_chr</span>(<span class="kw">as.list</span>(x), find_assign_rec)</a>
<a class="sourceLine" id="cb715-14" data-line-number="14">      }</a>
<a class="sourceLine" id="cb715-15" data-line-number="15">    }</a>
<a class="sourceLine" id="cb715-16" data-line-number="16">  )</a>
<a class="sourceLine" id="cb715-17" data-line-number="17">}</a>
<a class="sourceLine" id="cb715-18" data-line-number="18"></a>
<a class="sourceLine" id="cb715-19" data-line-number="19"><span class="kw">find_assign</span>(a &lt;-<span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb715-20" data-line-number="20"><span class="co">#&gt; [1] &quot;a&quot;</span></a>
<a class="sourceLine" id="cb715-21" data-line-number="21"><span class="kw">find_assign</span>({</a>
<a class="sourceLine" id="cb715-22" data-line-number="22">  a &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb715-23" data-line-number="23">  {</a>
<a class="sourceLine" id="cb715-24" data-line-number="24">    b &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb715-25" data-line-number="25">  }</a>
<a class="sourceLine" id="cb715-26" data-line-number="26">})</a>
<a class="sourceLine" id="cb715-27" data-line-number="27"><span class="co">#&gt; [1] &quot;a&quot; &quot;b&quot;</span></a></code></pre></div>
<p>Now we need to make our function more robust by coming up with examples intended to break it. What happens when we assign to the same variable multiple times?</p>
<div class="sourceCode" id="cb716"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb716-1" data-line-number="1"><span class="kw">find_assign</span>({</a>
<a class="sourceLine" id="cb716-2" data-line-number="2">  a &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb716-3" data-line-number="3">  a &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb716-4" data-line-number="4">})</a>
<a class="sourceLine" id="cb716-5" data-line-number="5"><span class="co">#&gt; [1] &quot;a&quot; &quot;a&quot;</span></a></code></pre></div>
<p>It’s easiest to fix this at the level of the wrapper function:</p>
<div class="sourceCode" id="cb717"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb717-1" data-line-number="1">find_assign &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">unique</span>(<span class="kw">find_assign_rec</span>(<span class="kw">enexpr</span>(x)))</a>
<a class="sourceLine" id="cb717-2" data-line-number="2"></a>
<a class="sourceLine" id="cb717-3" data-line-number="3"><span class="kw">find_assign</span>({</a>
<a class="sourceLine" id="cb717-4" data-line-number="4">  a &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb717-5" data-line-number="5">  a &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb717-6" data-line-number="6">})</a>
<a class="sourceLine" id="cb717-7" data-line-number="7"><span class="co">#&gt; [1] &quot;a&quot;</span></a></code></pre></div>
<p>What happens if we have nested calls to <code>&lt;-</code>? Currently we only return the first. That’s because when <code>&lt;-</code> occurs we immediately terminate recursion.</p>
<div class="sourceCode" id="cb718"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb718-1" data-line-number="1"><span class="kw">find_assign</span>({</a>
<a class="sourceLine" id="cb718-2" data-line-number="2">  a &lt;-<span class="st"> </span>b &lt;-<span class="st"> </span>c &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb718-3" data-line-number="3">})</a>
<a class="sourceLine" id="cb718-4" data-line-number="4"><span class="co">#&gt; [1] &quot;a&quot;</span></a></code></pre></div>
<p>Instead we need to take a more rigorous approach. I think it’s best to keep the recursive function focused on the tree structure, so I’m going to extract out <code>find_assign_call()</code> into a separate function.</p>
<div class="sourceCode" id="cb719"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb719-1" data-line-number="1">find_assign_call &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb719-2" data-line-number="2">  <span class="cf">if</span> (<span class="kw">is_call</span>(x, <span class="st">&quot;&lt;-&quot;</span>) <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">is_symbol</span>(x[[<span class="dv">2</span>]])) {</a>
<a class="sourceLine" id="cb719-3" data-line-number="3">    lhs &lt;-<span class="st"> </span><span class="kw">as_string</span>(x[[<span class="dv">2</span>]])</a>
<a class="sourceLine" id="cb719-4" data-line-number="4">    children &lt;-<span class="st"> </span><span class="kw">as.list</span>(x)[<span class="op">-</span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb719-5" data-line-number="5">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb719-6" data-line-number="6">    lhs &lt;-<span class="st"> </span><span class="kw">character</span>()</a>
<a class="sourceLine" id="cb719-7" data-line-number="7">    children &lt;-<span class="st"> </span><span class="kw">as.list</span>(x)</a>
<a class="sourceLine" id="cb719-8" data-line-number="8">  }</a>
<a class="sourceLine" id="cb719-9" data-line-number="9">  </a>
<a class="sourceLine" id="cb719-10" data-line-number="10">  <span class="kw">c</span>(lhs, <span class="kw">flat_map_chr</span>(children, find_assign_rec))</a>
<a class="sourceLine" id="cb719-11" data-line-number="11">}</a>
<a class="sourceLine" id="cb719-12" data-line-number="12"></a>
<a class="sourceLine" id="cb719-13" data-line-number="13">find_assign_rec &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb719-14" data-line-number="14">  <span class="kw">switch_expr</span>(x,</a>
<a class="sourceLine" id="cb719-15" data-line-number="15">    <span class="co"># Base cases</span></a>
<a class="sourceLine" id="cb719-16" data-line-number="16">    <span class="dt">constant =</span> ,</a>
<a class="sourceLine" id="cb719-17" data-line-number="17">    <span class="dt">symbol =</span> <span class="kw">character</span>(),</a>
<a class="sourceLine" id="cb719-18" data-line-number="18">    </a>
<a class="sourceLine" id="cb719-19" data-line-number="19">    <span class="co"># Recursive cases</span></a>
<a class="sourceLine" id="cb719-20" data-line-number="20">    <span class="dt">pairlist =</span> <span class="kw">flat_map_chr</span>(x, find_assign_rec),</a>
<a class="sourceLine" id="cb719-21" data-line-number="21">    <span class="dt">call =</span> <span class="kw">find_assign_call</span>(x)</a>
<a class="sourceLine" id="cb719-22" data-line-number="22">  )</a>
<a class="sourceLine" id="cb719-23" data-line-number="23">}</a>
<a class="sourceLine" id="cb719-24" data-line-number="24"></a>
<a class="sourceLine" id="cb719-25" data-line-number="25"><span class="kw">find_assign</span>(a &lt;-<span class="st"> </span>b &lt;-<span class="st"> </span>c &lt;-<span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb719-26" data-line-number="26"><span class="co">#&gt; [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;</span></a>
<a class="sourceLine" id="cb719-27" data-line-number="27"><span class="kw">find_assign</span>(<span class="kw">system.time</span>(x &lt;-<span class="st"> </span><span class="kw">print</span>(y &lt;-<span class="st"> </span><span class="dv">5</span>)))</a>
<a class="sourceLine" id="cb719-28" data-line-number="28"><span class="co">#&gt; [1] &quot;x&quot; &quot;y&quot;</span></a></code></pre></div>
<p>While the complete version of this function is quite complicated, it’s important to remember we wrote it by working our way up by writing simple component parts.</p>
</div>
<div id="exercises-54" class="section level3">
<h3><span class="header-section-number">17.6.3</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p><code>logical_abbr()</code> returns <code>TRUE</code> for <code>T(1, 2, 3)</code>. How could you modify
<code>logical_abbr_rec()</code> so that it ignores function calls that use <code>T</code> or <code>F</code>?</p></li>
<li><p><code>logical_abbr()</code> works with expressions. It currently fails when you give it
a function. Why not? How could you modify <code>logical_abbr()</code> to make it
work? What components of a function will you need to recurse over?</p>
<div class="sourceCode" id="cb720"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb720-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">x =</span> <span class="ot">TRUE</span>) {</a>
<a class="sourceLine" id="cb720-2" data-line-number="2">  <span class="kw">g</span>(x <span class="op">+</span><span class="st"> </span>T)</a>
<a class="sourceLine" id="cb720-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb720-4" data-line-number="4"><span class="kw">logical_abbr</span>(<span class="op">!!</span>f)</a></code></pre></div></li>
<li><p>Modify find assignment to also detect assignment using replacement
functions, i.e. <code>names(x) &lt;- y</code>.</p></li>
<li><p>Write a function that extracts all calls to a specified function.</p></li>
</ol>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-r-lang">
<p>R Core Team. 2018b. <em>R Language Definition</em>. Vienna, Austria: R Foundation for Statistical Computing. <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html" class="uri">https://cran.r-project.org/doc/manuals/r-release/R-lang.html</a>.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="51">
<li id="fn51"><p>Some programming languages use <strong>postfix</strong> calls where the name of the function comes last. If you ever used an old HP calculator, you might have fallen in love with reverse Polish notation, postfix notation for algebra. There is also a family of “stack”-based programming languages descending from Forth which takes this idea as far as it might possibly go.<a href="expressions.html#fnref51" class="footnote-back">↩</a></p></li>
<li id="fn52"><p>These two sources of ambiguity do not exist without infix operators, which can be considered an advantage of purely prefix and postfix languages. It’s interesting to compare a simple arithmetic operation in Lisp (prefix) and Forth (postfix). In Lisp you’d write <code>(+ (+ 1 2) 3))</code>; this avoids ambiguity by requiring parentheses everywhere. In Forth, you’d write <code>1 2 + 3 +</code>; this doesn’t require any parentheses, but does require more thought when reading.<a href="expressions.html#fnref52" class="footnote-back">↩</a></p></li>
<li id="fn53"><p>If you’re working in C, you’ll encounter pairlists more often. For example, calls are also implemented using pairlists.<a href="expressions.html#fnref53" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="meta.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="quasiquotation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/hadley/adv-r/edit/master/Expressions.Rmd",
"text": "Edit"
},
"download": [["https://github.com/BruceZhaoR/adv-r/raw/gh-pages/_main.pdf", "PDF"], ["https://github.com/BruceZhaoR/adv-r/raw/gh-pages/_main.epub", "EPUB3"]],
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
